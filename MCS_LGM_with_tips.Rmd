---
title: "MCS LGM (with tip)"
author: "Yira Zhang"
date: "2023-02-09"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(ggplot2)
library(tidyr)
library(data.table)
library(tidyverse)
library(lavaan)
```

## Data
# Load prepared data
```{r}
# Cr. Genie
MCS_autism <- read.csv("/Users/zhangxinhe/Documents/who recieves a diagnosis/MCS/MCS_SDQ_autism.csv") # 188 in total
MCS_sdq_autism <- MCS_autism[,c(1:21,34:39,22:33,40:45)]
MCS_sdq_autism$sex_num <- ifelse(MCS_sdq_autism$Sex =="Male", 1, 0)
MCS_adhd <- read.csv("/Users/zhangxinhe/Documents/who recieves a diagnosis/MCS/MCS_SDQ_adhd.csv") # 89 in total
MCS_sdq_adhd <- MCS_adhd[,c(1:21,34:39,22:33,40:45)]
MCS_autism_adhd_both <- read.csv("/Users/zhangxinhe/Documents/who recieves a diagnosis/MCS/MCS_SDQ_both.csv")
MCS_sdq_both <- MCS_autism_adhd_both[,c(1:21,34:39,22:33,40:45)]
MCS_no_diag <- read.csv("/Users/zhangxinhe/Documents/who recieves a diagnosis/MCS/MCS_SDQ_control.csv") # 6047 in total
MCS_sdq_no_diag <- MCS_no_diag[,c(1:21,34:39,22:33,40:45)]
```

# Load predictors
```{r}
mcs2_parent_interview <- read_delim("/Users/zhangxinhe/Documents/who recieves a diagnosis/MCS/MCS_data/UKDA-5350-tab/tab/mcs2_parent_interview.tab")
mcs_ID_identifier <- read.csv("/Users/zhangxinhe/Documents/who recieves a diagnosis/MCS/mcs_ID_identifier.csv")
mcs_ethnicity_mbirth_age <- read.csv("/Users/zhangxinhe/Documents/who recieves a diagnosis/MCS/mcs_race_mbirthage.csv")
mcs2_ses_identifier <- read.csv("/Users/zhangxinhe/Documents/who recieves a diagnosis/MCS/mcs_ses_identifier.csv")
mcs2_dep_identifier <- read.csv("/Users/zhangxinhe/Documents/who recieves a diagnosis/MCS/mcs_deprivation_identifier.csv")
mcs2_family_derived <- read_delim("/Users/zhangxinhe/Documents/who recieves a diagnosis/MCS/MCS_data/UKDA-5350-tab/tab/mcs2_family_derived.tab")
mcs2_other_ses_identifier <- read.csv("/Users/zhangxinhe/Documents/who recieves a diagnosis/MCS/mcs_other_ses_identifier.csv")
```


## Autism
# Reshape data to plot-ready form
```{r}
# Group autstic group according to their diagnosis age
# Though some parents provided specific diagnosis age in years, to conform to analysis in other cohorts so that cross-population comparisons could be allowed in the future
# "Early" = first reported diagnosis at w3 (age5) or w4 (age7)
# "Late = first reported diagnosis at w5 (age11) or w6 (age14)


MCS_sdq_autism_early <- MCS_sdq_autism %>% filter (ASD.Diagnosis.Age %in% c("at W3","at W4","at W5")) # n = 118

MCS_sdq_autism_late <- MCS_sdq_autism %>% filter (ASD.Diagnosis.Age %in% c("at W6")) # n = 70
MCS_sdq_autism$grp <- ifelse(MCS_sdq_autism$ASD.Diagnosis.Age %in% c("at W3","at W4","at W5"), "Early", ifelse(MCS_sdq_autism$ASD.Diagnosis.Age %in% c("at W6"), "Late", NA))
```

## LGM
# Simple model
```{r}
library(lavaan)
MCS_simplest_glm <- 
  "int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
   slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT"

MCS_simple_lgm_fit_early <- growth(MCS_simplest_glm, 
                           data = MCS_sdq_autism_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_early)

MCS_simple_lgm_fit_late <- growth(MCS_simplest_glm, 
                           data = MCS_sdq_autism_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_late)

MCS_simple_lgm_fit_no_diag <- growth(MCS_simplest_glm, 
                           data = MCS_sdq_no_diag,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_no_diag)
```
```{r}
msc_lgm_ttl_est_early <- parameterEstimates(MCS_simple_lgm_fit_early) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_ttl_early <- msc_lgm_ttl_est_early %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates =sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

msc_lgm_ttl_est_late <- parameterEstimates(MCS_simple_lgm_fit_late) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_ttl_late <- msc_lgm_ttl_est_late %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

msc_lgm_ttl_est_no_diag <- parameterEstimates(MCS_simple_lgm_fit_no_diag) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_ttl_no_diag <- msc_lgm_ttl_est_no_diag %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

mcs_lgm_ttl_results <- rbind(results_lgm_ttl_early,results_lgm_ttl_late,results_lgm_ttl_no_diag)
mcs_lgm_ttl_results
```

```{r}
MCS_simple_lgm_fit_timestr <- growth(MCS_simplest_glm, data = MCS_sdq_autism, group = "grp",
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )
summary(MCS_simple_lgm_fit_timestr)



MCS_simple_lgm_fit_sexstra <- growth(MCS_simplest_glm, 
                           data = MCS_sdq_autism,group = "Sex",
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )
summary(MCS_simple_lgm_fit_sexstra)
# Female (n = 51): i = 9.134, s = 1.426; Male (n = 135): i = 12.248, s = 0.797

MCS_simple_lgm_fit_autism <- growth(MCS_simplest_glm, data = MCS_sdq_autism,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )
summary(MCS_simple_lgm_fit_autism)

```
```{r}
anova(MCS_simple_lgm_fit_autism,MCS_simple_lgm_fit_sexstra)
anova(MCS_simple_lgm_fit_autism,MCS_simple_lgm_fit_timestr)


```

```{r}

MCS_simplest_glm_agestr <- 
  "int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
   slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT
   int ~ grp
slp ~ grp
grp ~~ grp"

MCS_simple_lgm_fit_bysex_agrstr <- growth(MCS_simplest_glm_agestr, 
                           data = MCS_sdq_autism,group = "Sex",
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )
summary(MCS_simple_lgm_fit_bysex_agrstr)

```

```{r}
nonnest2::vuongtest(MCS_simple_lgm_fit_sexstra,MCS_simple_lgm_fit_timestr, nested = FALSE)

```
```{r}
# not correct 
coeff1 <- c(14.525424,12.305085,12.414,0.590)
coeff1 <- matrix(coeff1, 2, 2)
coeff2 <- c(15.857143,11.042857, 9.933 ,1.499 )
coeff2 <- matrix(coeff2,2,2)
# Extract the trajectory matrix
diff <- coeff1 - coeff2
norm(diff,type = "F")
```
```{r}
comp <- compareFit(MCS_simple_lgm_fit_early, MCS_simple_lgm_fit_late, nested = FALSE, argsLRT = list(), indices = TRUE,
  moreIndices = FALSE, baseline.model = NULL, nPrior = 1)
summary(comp)
```



```{r}
library(lavaan)
MCS_simplest_glm_emo <- 
  "int =~ 1*BEMOTION + 1*CEMOTION + 1*DDEMOTION + 1*EEMOTION + 1*FEMOTION + 1*GEMOTION
   slp =~ 0*BEMOTION + 1*CEMOTION + 2*DDEMOTION + 3*EEMOTION + 4*FEMOTION + 5*GEMOTION"

MCS_simple_lgm_fit_early_emo <- growth(MCS_simplest_glm_emo , 
                           data = MCS_sdq_autism_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_early_emo )

MCS_simple_lgm_fit_late_emo  <- growth(MCS_simplest_glm_emo , 
                           data = MCS_sdq_autism_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_late_emo )

MCS_simple_lgm_fit_no_diag_emo  <- growth(MCS_simplest_glm_emo , 
                           data = MCS_sdq_no_diag,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_no_diag_emo )
```

```{r}
msc_lgm_emo_est_early <- parameterEstimates(MCS_simple_lgm_fit_early_emo) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_emo_early <- msc_lgm_emo_est_early %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates =sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

msc_lgm_emo_est_late <- parameterEstimates(MCS_simple_lgm_fit_late_emo) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_emo_late <- msc_lgm_emo_est_late %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

msc_lgm_emo_est_no_diag <- parameterEstimates(MCS_simple_lgm_fit_no_diag_emo) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_emo_no_diag <- msc_lgm_emo_est_no_diag %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

mcs_lgm_emo_results <- rbind(results_lgm_emo_early,results_lgm_emo_late,results_lgm_emo_no_diag)
mcs_lgm_emo_results
```

```{r}
library(lavaan)
MCS_simplest_glm_con <- 
  "int =~ 1*BCONDUCT + 1*CCONDUCT + 1*DDCONDUCT + 1*ECONDUCT + 1*FCONDUCT + 1*GCONDUCT
   slp =~ 0*BCONDUCT + 1*CCONDUCT + 2*DDCONDUCT + 3*ECONDUCT + 4*FCONDUCT + 5*GCONDUCT"

MCS_simple_lgm_fit_early_con <- growth(MCS_simplest_glm_con, 
                           data = MCS_sdq_autism_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_early_con)

MCS_simple_lgm_fit_late_con <- growth(MCS_simplest_glm_con, 
                           data = MCS_sdq_autism_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_late_con)

MCS_simple_lgm_fit_no_diag_con <- growth(MCS_simplest_glm_con, 
                           data = MCS_sdq_no_diag,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_no_diag_con)
```

```{r}
msc_lgm_con_est_early <- parameterEstimates(MCS_simple_lgm_fit_early_con) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_con_early <- msc_lgm_con_est_early %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates =sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

msc_lgm_con_est_late <- parameterEstimates(MCS_simple_lgm_fit_late_con) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_con_late <- msc_lgm_con_est_late %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

msc_lgm_con_est_no_diag <- parameterEstimates(MCS_simple_lgm_fit_no_diag_con) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_con_no_diag <- msc_lgm_con_est_no_diag %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

mcs_lgm_con_results <- rbind(results_lgm_con_early,results_lgm_con_late,results_lgm_con_no_diag)
mcs_lgm_con_results
```


```{r}
library(lavaan)
MCS_simplest_glm_hyp <- 
  "int =~ 1*BHYPER + 1*CHYPER + 1*DDHYPER + 1*EHYPER + 1*FHYPER + 1*GHYPER
   slp =~ 0*BHYPER + 1*CHYPER + 2*DDHYPER + 3*EHYPER + 4*FHYPER + 5*GHYPER"

MCS_simple_lgm_fit_early_hyp <- growth(MCS_simplest_glm_hyp, 
                           data = MCS_sdq_autism_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_early_hyp)

MCS_simple_lgm_fit_late_hyp <- growth(MCS_simplest_glm_hyp, 
                           data = MCS_sdq_autism_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_late_hyp)

MCS_simple_lgm_fit_no_diag_hyp <- growth(MCS_simplest_glm_hyp, 
                           data = MCS_sdq_no_diag,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_no_diag_hyp)
```

```{r}
msc_lgm_hyp_est_early <- parameterEstimates(MCS_simple_lgm_fit_early_hyp) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_hyp_early <- msc_lgm_hyp_est_early %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates =sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

msc_lgm_hyp_est_late <- parameterEstimates(MCS_simple_lgm_fit_late_hyp) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_hyp_late <- msc_lgm_hyp_est_late %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

msc_lgm_hyp_est_no_diag <- parameterEstimates(MCS_simple_lgm_fit_no_diag_hyp) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_hyp_no_diag <- msc_lgm_hyp_est_no_diag %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

mcs_lgm_hyp_results <- rbind(results_lgm_hyp_early,results_lgm_hyp_late,results_lgm_hyp_no_diag)
mcs_lgm_hyp_results
```


```{r}
library(lavaan)
MCS_simplest_glm_peer <- 
  "int =~ 1*BPEER + 1*CPEER + 1*DDPEER + 1*EPEER + 1*FPEER + 1*GPEER
   slp =~ 0*BPEER + 1*CPEER + 2*DDPEER + 3*EPEER + 4*FPEER + 5*GPEER"

MCS_simple_lgm_fit_early_peer <- growth(MCS_simplest_glm_peer, 
                           data = MCS_sdq_autism_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_early_peer)

MCS_simple_lgm_fit_late_peer <- growth(MCS_simplest_glm_peer, 
                           data = MCS_sdq_autism_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_late_peer)

MCS_simple_lgm_fit_no_diag_peer <- growth(MCS_simplest_glm_peer, 
                           data = MCS_sdq_no_diag,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_no_diag_peer)
```

```{r}
msc_lgm_peer_est_early <- parameterEstimates(MCS_simple_lgm_fit_early_peer) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_peer_early <- msc_lgm_peer_est_early %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates =sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

msc_lgm_peer_est_late <- parameterEstimates(MCS_simple_lgm_fit_late_peer) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_peer_late <- msc_lgm_peer_est_late %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

msc_lgm_peer_est_no_diag <- parameterEstimates(MCS_simple_lgm_fit_no_diag_peer) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_peer_no_diag <- msc_lgm_peer_est_no_diag %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

mcs_lgm_peer_results <- rbind(results_lgm_peer_early,results_lgm_peer_late,results_lgm_peer_no_diag)
mcs_lgm_peer_results
```




```{r}

MCS_simplest_glm_pro <- 
  "int =~ 1*BPROSOC + 1*CPROSOC + 1*DDPROSOC + 1*EPROSOC + 1*FPROSOC + 1*GPROSOC
   slp =~ 0*BPROSOC + 1*CPROSOC + 2*DDPROSOC + 3*EPROSOC + 4*FPROSOC + 5*GPROSOC"

MCS_simple_lgm_fit_early_pro <- growth(MCS_simplest_glm_pro, 
                           data = MCS_sdq_autism_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_early_pro)


MCS_simple_lgm_fit_late_pro <- growth(MCS_simplest_glm_pro, 
                           data = MCS_sdq_autism_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_late_pro)

MCS_simple_lgm_fit_no_diag_pro <- growth(MCS_simplest_glm_pro, 
                           data = MCS_sdq_no_diag,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_simple_lgm_fit_no_diag_pro)
```
```{r}
msc_lgm_pro_est_early <- parameterEstimates(MCS_simple_lgm_fit_early_pro) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_pro_early <- msc_lgm_pro_est_early %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates =sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

msc_lgm_pro_est_late <- parameterEstimates(MCS_simple_lgm_fit_late_pro) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_pro_late <- msc_lgm_pro_est_late %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

msc_lgm_pro_est_no_diag <- parameterEstimates(MCS_simple_lgm_fit_no_diag_pro) %>% filter(grepl("int|slp", lhs)& op == "~1")
results_lgm_pro_no_diag <- msc_lgm_pro_est_no_diag %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

mcs_lgm_pro_results <- rbind(results_lgm_pro_early,results_lgm_pro_late,results_lgm_pro_no_diag)
mcs_lgm_pro_results
```


# Adding Predictors
# ADDAGB00 # Mother's age at giving birth

# Ethnic group
APBETE00  # England
APBETW00 # Wales
APBETS00  #Scotland
APBETI00 # Northern Ireland

# Highest educational attainment
APACQU00
BPACQU00

# Cognitive ability 
# Sweep 2 (age 3)
# the Bracken School Readiness Assessment-Revised (Bracken, 1998) (conceptual knowledge) (BSRA-R) 
BDSRCS00 # school readiness composit standard score
BDSRCP00 # percentile
BDSRCN00 # normative classification

# the BAS-II Naming Vocabulary test (Elliott et al., 1997) (expressive language ability)  
BDBASR00 # raw score
BDBASA00 # ability score 2
BDBASP00 # Percentile
BDBAST00 # T-score

# Sweep 3 (age 5)
# BAS Naming Vocabulary
CCNSCO00 # total score
CCNVABIL # ability score
CCNVTSCORE # T-score

# BAS Pattern Construction (spatial problem-solving ability)
CCCSCO00 # Total score
CCPCABIL # ability score
CCPCTSCORE # T-score
CCCPAS00 # number of correct responses
CCCERR00 # number of incorrect responses

# BAS Picture Similarities (non-verbal reasoning)  
CCPSCO00 # total raw score
CCPSABIL # ability score
CCPSTSCORE # T-score


# Sweep 4 (age 7)
# pattern construction 
DCTOTS00 # raw score
DCPCAB00 # ability score
DCPCTS00 # age-based T-scores

#word reading scores from the BAS-II
DCWRAB00 # ability score
DCWRSD00 # standard score

# a shortened version of the Progress in Maths tests (Connelly, 2013) (National Foundation for education Research). 
DCMATHS7SC # raw score scaled to original test out of 28 marks
DCMATHS7SA # age standardised score

# Sweep 5 (age 11)
# the BAS Verbal Similarities (verbal knowledge and reasoning capability) 
ECDTOT00 # total correct responses


# the error scores on the spatial working memory (SWM) task (representative of executive functioning (Atkinson, 2015)) from the Cambridge Neuropsychological Test Automated Battery (Robbins et al., 1994) (CANTAB)
# no available data

# Sweep 6 (age 13)
# Word activity
FCWRDSC # score out of 20



## Intellectual disability
```{r}
mcs_autism_ID <- mcs_ID_identifier[mcs_ID_identifier$mcs_cog_pca.MCSID %in% MCS_sdq_autism$MCSID, ]
mcs_autism_ID <- mcs_autism_ID[,2:6]
colnames(mcs_autism_ID) <- c("MCSID","CNUM00","CMID","PC1","ID")
MCS_sdq_autism_early_id <- inner_join(MCS_sdq_autism_early, mcs_autism_ID, by = "MCSID")
MCS_sdq_autism_late_id <- inner_join(MCS_sdq_autism_late, mcs_autism_ID, by = "MCSID")
```

```{r}

MCS_lgm_id  <- "
  int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
  slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT
  
  BEBDTOT ~~ a*BEBDTOT
  CEBDTOT ~~ a*CEBDTOT
  DDDEBDTOT ~~ a*DDDEBDTOT
  EEBDTOT ~~ a*EEBDTOT
  FEBDTOT ~~ a*FEBDTOT
  GEBDTOT ~~ a*GEBDTOT
  

  int ~ PC1 
  slp ~ PC1 
  
  PC1 ~~ PC1
 
"

MCS_glm_id_fit_early <- growth(MCS_lgm_id, 
                           data = MCS_sdq_autism_early_id,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_id_fit_early)


MCS_glm_id_fit_late <- growth(MCS_lgm_id, 
                           data = MCS_sdq_autism_late_id,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_id_fit_late)
```
```{r}
anova(MCS_glm_id_fit_early, MCS_glm_id_fit_late)
```
# Test if adding id is useful for model fit
```{r}
MCS_lgm_id_test  <- "
  int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
  slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT
  int ~ 0*PC1 
  slp ~ 0*PC1
  BEBDTOT ~~ a*BEBDTOT
  CEBDTOT ~~ a*CEBDTOT
  DDDEBDTOT ~~ a*DDDEBDTOT
  EEBDTOT ~~ a*EEBDTOT
  FEBDTOT ~~ a*FEBDTOT
  GEBDTOT ~~ a*GEBDTOT
  
  
"

MCS_glm_id_fit_early_test <- growth(MCS_lgm_id_test, 
                           data = MCS_sdq_autism_early_id,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_id_fit_early_test)


MCS_glm_id_fit_late_test <- growth(MCS_lgm_id_test, 
                           data = MCS_sdq_autism_late_id,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_id_fit_late_test)
```


```{r}
anova(MCS_glm_id_fit_early, MCS_glm_id_fit_early_test)
anova(MCS_glm_id_fit_late, MCS_glm_id_fit_late_test)
```
## SEX
```{r}
MCS_lgm_sex  <- "
  int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
  slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT

  int ~ sex_num 
  slp ~ sex_num
  
  sex_num ~~ sex_num
 
"

MCS_glm_sex_fit_early <- growth(MCS_lgm_sex, 
                           data = MCS_sdq_autism_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_sex_fit_early)


MCS_glm_sex_fit_late <- growth(MCS_lgm_sex, 
                           data = MCS_sdq_autism_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_sex_fit_late)
```


```{r}
MCS_lgm_sex_test  <- "
  int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
  slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT
  
  BEBDTOT ~~ a*BEBDTOT
  CEBDTOT ~~ a*CEBDTOT
  DDDEBDTOT ~~ a*DDDEBDTOT
  EEBDTOT ~~ a*EEBDTOT
  FEBDTOT ~~ a*FEBDTOT
  GEBDTOT ~~ a*GEBDTOT
  

  int ~ 0*sex_num 
  slp ~ 0*sex_num
 
"

MCS_glm_sex_fit_early_test <- growth(MCS_lgm_sex_test, 
                           data = MCS_sdq_autism_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_id_fit_early_test)


MCS_glm_sex_fit_late_test <- growth(MCS_lgm_sex_test, 
                           data = MCS_sdq_autism_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_sex_fit_late_test)
```

```{r}
anova(MCS_glm_sex_fit_early,MCS_glm_sex_fit_early_test)
anova(MCS_glm_sex_fit_late,MCS_glm_sex_fit_late_test)
```

## SES, mother age at giving birth, ethnicty
```{r}
mcs1_ethnicity <- mcs_ethnicity_mbirth_age[,2:6]
mcs1_birth_age <- mcs_ethnicity_mbirth_age[,c(2,7,8)]
mcs_autism_eth <- mcs1_ethnicity[mcs1_ethnicity$MCSID %in% MCS_sdq_autism$MCSID, ]
mcs_autism_mbirthage <- mcs1_birth_age[mcs1_birth_age$MCSID %in% MCS_sdq_autism$MCSID, ]
mcs_autism_eth_mbirthage <- inner_join(mcs1_birth_age, mcs_autism_eth, by = "MCSID")
MCS_sdq_autism_early_eth <- inner_join(MCS_sdq_autism_early,mcs_autism_eth, by = "MCSID")
MCS_sdq_autism_late_eth <- inner_join(MCS_sdq_autism_late,mcs_autism_eth, by = "MCSID")
MCS_sdq_autism_early_birthage <- inner_join(MCS_sdq_autism_early,mcs_autism_mbirthage, by = "MCSID")
MCS_sdq_autism_late_birthage <- inner_join(MCS_sdq_autism_late,mcs_autism_mbirthage, by = "MCSID")
MCS_sdq_autism_early_eth_birthage <- inner_join(MCS_sdq_autism_early, mcs_autism_eth_mbirthage, by = "MCSID")
MCS_sdq_autism_late_eth_birthage <- inner_join(MCS_sdq_autism_late, mcs_autism_eth_mbirthage, by = "MCSID")

```

## Ethnicity alone
```{r}

MCS_lgm_eth  <- "
  int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
  slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT
  
  BEBDTOT ~~ a*BEBDTOT
  CEBDTOT ~~ a*CEBDTOT
  DDDEBDTOT ~~ a*DDDEBDTOT
  EEBDTOT ~~ a*EEBDTOT
  FEBDTOT ~~ a*FEBDTOT
  GEBDTOT ~~ a*GEBDTOT
  

  int ~   ADC06E00
  slp ~   ADC06E00
  
 
  ADC06E00 ~~ ADC06E00
 
"

MCS_glm_eth_fit_early <- growth(MCS_lgm_eth, 
                           data = MCS_sdq_autism_early_eth,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_eth_fit_early)


MCS_glm_eth_fit_late <- growth(MCS_lgm_eth, 
                           data = MCS_sdq_autism_late_eth,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_eth_fit_late)
```

# Test if adding id is useful for model fit
```{r}
MCS_lgm_eth_test  <- "
  int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
  slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT

  
  BEBDTOT ~~ a*BEBDTOT
  CEBDTOT ~~ a*CEBDTOT
  DDDEBDTOT ~~ a*DDDEBDTOT
  EEBDTOT ~~ a*EEBDTOT
  FEBDTOT ~~ a*FEBDTOT
  GEBDTOT ~~ a*GEBDTOT
  
  int ~ 0*ADC06E00
  slp ~  0*ADC06E00
  

  
  
"

MCS_glm_eth_fit_early_test <- growth(MCS_lgm_eth_test, 
                           data = MCS_sdq_autism_early_eth,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_eth_fit_early_test)


MCS_glm_eth_fit_late_test <- growth(MCS_lgm_eth_test, 
                           data = MCS_sdq_autism_late_eth,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_eth_fit_late_test)
```
```{r}
anova(MCS_glm_eth_fit_early, MCS_glm_eth_fit_early_test)
anova(MCS_glm_eth_fit_late, MCS_glm_eth_fit_late_test)
```

## Mother birth age alone
```{r}
MCS_lgm_mbirthage  <- "
  int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
  slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT
  
  BEBDTOT ~~ a*BEBDTOT
  CEBDTOT ~~ a*CEBDTOT
  DDDEBDTOT ~~ a*DDDEBDTOT
  EEBDTOT ~~ a*EEBDTOT
  FEBDTOT ~~ a*FEBDTOT
  GEBDTOT ~~ a*GEBDTOT
  

  int ~   ADDGAB00
  slp ~   ADDGAB00
  
 
  ADDGAB00 ~~ ADDGAB00
 
"

MCS_glm_mbirthage_fit_early <- growth(MCS_lgm_mbirthage, 
                           data = MCS_sdq_autism_early_birthage,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_mbirthage_fit_early)


MCS_glm_mbirthage_fit_late <- growth(MCS_lgm_mbirthage, 
                           data = MCS_sdq_autism_late_birthage,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_mbirthage_fit_late)
```

# Test if adding id is useful for model fit
```{r}
MCS_lgm_mbirthage_test  <- "
  int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
  slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT

  
  BEBDTOT ~~ a*BEBDTOT
  CEBDTOT ~~ a*CEBDTOT
  DDDEBDTOT ~~ a*DDDEBDTOT
  EEBDTOT ~~ a*EEBDTOT
  FEBDTOT ~~ a*FEBDTOT
  GEBDTOT ~~ a*GEBDTOT
  
  int ~ 0*ADDGAB00
  slp ~  0*ADDGAB00
  

  
  
"

MCS_glm_mbirthage_fit_early_test <- growth(MCS_lgm_mbirthage_test, 
                           data = MCS_sdq_autism_early_birthage,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_mbirthage_fit_early_test)


MCS_glm_mbirthage_fit_late_test <- growth(MCS_lgm_mbirthage_test, 
                           data = MCS_sdq_autism_late_birthage,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_mbirthage_fit_late_test)
```
```{r}
anova(MCS_glm_mbirthage_fit_early, MCS_glm_mbirthage_fit_early_test)
anova(MCS_glm_mbirthage_fit_late, MCS_glm_mbirthage_fit_late_test)
```


## SES indicator 
# PCA indicator (ended up with only 11 CMs)


## Test if adding SES is useful for model fit
# Highest Maternal Academic Qualification (as the indicator for SES)


# Other SES indicators
```{r}
# "IncomeQuant","LabourMrtSts","OECDPov","HouseTen"
mcs_autism_other_ses <- mcs2_other_ses_identifier[mcs2_other_ses_identifier$MCSID %in% MCS_sdq_autism$MCSID,]
mcs_autism_other_ses <- mcs_autism_other_ses[,c(2:6,8)]
MCS_sdq_autism_early_other_ses <- merge(MCS_sdq_autism_early, mcs_autism_other_ses, by = "MCSID")
MCS_sdq_autism_late_other_ses <- merge(MCS_sdq_autism_late, mcs_autism_other_ses, by = "MCSID")
```

```{r}

MCS_lgm_other_ses  <- "
  int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
  slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT
  
  BEBDTOT ~~ a*BEBDTOT
  CEBDTOT ~~ a*CEBDTOT
  DDDEBDTOT ~~ a*DDDEBDTOT
  EEBDTOT ~~ a*EEBDTOT
  FEBDTOT ~~ a*FEBDTOT
  GEBDTOT ~~ a*GEBDTOT
  

  int ~ PC1
  slp ~ PC1
  
  PC1 ~~ PC1
 
"

MCS_glm_other_ses_fit_early <- growth(MCS_lgm_other_ses, 
                           data = MCS_sdq_autism_early_other_ses,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_other_ses_fit_early)


MCS_glm_other_ses_fit_late <- growth(MCS_lgm_other_ses, 
                           data = MCS_sdq_autism_late_other_ses,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_other_ses_fit_late)
```

## Test if adding other_ses is useful for model fit
```{r}
MCS_lgm_other_ses_test  <- "
  int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
  slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT
  int ~ 0*PC1 
  slp ~ 0*PC1
  BEBDTOT ~~ a*BEBDTOT
  CEBDTOT ~~ a*CEBDTOT
  DDDEBDTOT ~~ a*DDDEBDTOT
  EEBDTOT ~~ a*EEBDTOT
  FEBDTOT ~~ a*FEBDTOT
  GEBDTOT ~~ a*GEBDTOT
  
  
"

MCS_glm_other_ses_fit_early_test <- growth(MCS_lgm_other_ses_test, 
                           data = MCS_sdq_autism_early_other_ses,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_other_ses_fit_early_test)


MCS_glm_other_ses_fit_late_test <- growth(MCS_lgm_other_ses_test, 
                           data = MCS_sdq_autism_late_other_ses,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_other_ses_fit_late_test)
```


```{r}
anova(MCS_glm_other_ses_fit_early, MCS_glm_other_ses_fit_early_test)
anova(MCS_glm_other_ses_fit_late, MCS_glm_other_ses_fit_late_test)
```












## Deprivation indicator
```{r}
mcs_autism_dep <- mcs2_dep_identifier[mcs2_dep_identifier$MCSID %in% MCS_sdq_autism$MCSID, ]
mcs_autism_dep <- mcs_autism_dep[,1:8]
MCS_sdq_autism_early_dep <- merge(MCS_sdq_autism_early, mcs_autism_dep, by = "MCSID")
MCS_sdq_autism_late_dep <- merge(MCS_sdq_autism_late, mcs_autism_dep, by = "MCSID")
```

```{r}

MCS_lgm_dep  <- "
  int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
  slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT
  
  BEBDTOT ~~ a*BEBDTOT
  CEBDTOT ~~ a*CEBDTOT
  DDDEBDTOT ~~ a*DDDEBDTOT
  EEBDTOT ~~ a*EEBDTOT
  FEBDTOT ~~ a*FEBDTOT
  GEBDTOT ~~ a*GEBDTOT
  

  int ~ PC1
  slp ~ PC1
  
  PC1 ~~ PC1
 
"

MCS_glm_dep_fit_early <- growth(MCS_lgm_dep, 
                           data = MCS_sdq_autism_early_dep,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_dep_fit_early)


MCS_glm_dep_fit_late <- growth(MCS_lgm_dep, 
                           data = MCS_sdq_autism_late_dep,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_dep_fit_late)
```

# Test if adding dep is useful for model fit
```{r}
MCS_lgm_dep_test  <- "
  int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
  slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT
  int ~ 0*PC1 
  slp ~ 0*PC1
  BEBDTOT ~~ a*BEBDTOT
  CEBDTOT ~~ a*CEBDTOT
  DDDEBDTOT ~~ a*DDDEBDTOT
  EEBDTOT ~~ a*EEBDTOT
  FEBDTOT ~~ a*FEBDTOT
  GEBDTOT ~~ a*GEBDTOT
  
  
"

MCS_glm_dep_fit_early_test <- growth(MCS_lgm_dep_test, 
                           data = MCS_sdq_autism_early_dep,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_dep_fit_early_test)


MCS_glm_dep_fit_late_test <- growth(MCS_lgm_dep_test, 
                           data = MCS_sdq_autism_late_dep,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_dep_fit_late_test)
```


```{r}
anova(MCS_glm_dep_fit_early, MCS_glm_dep_fit_early_test)
anova(MCS_glm_dep_fit_late, MCS_glm_dep_fit_late_test)
```

## Use every predictor (all tip)
```{r}
all_tip_list = list(mcs_autism_ID, mcs_autism_eth, mcs_autism_mbirthage, mcs_autism_other_ses, mcs_autism_dep)
mcs_autism_all_tip <- all_tip_list %>% reduce(inner_join, by = "MCSID")
mcs_autism_all_tip_early <- merge(MCS_sdq_autism_early, mcs_autism_all_tip, by = "MCSID")
mcs_autism_all_tip_late <- merge(MCS_sdq_autism_late, mcs_autism_all_tip, by = "MCSID")
```

# A lgm model with all the tips selected above
```{r}
MCS_lgm_all_tip <- "
  int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
  slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT
  
  int ~ sex_num + PC1.x + ADC11E00 + ADDGAB00 + PC1.y + PC1
  slp ~ sex_num + PC1.x + ADC11E00 + ADDGAB00 + PC1.y + PC1
  
  
  sex_num ~~ sex_num
  PC1.x ~~ PC1.x
  ADC11E00 ~~ ADC11E00
  ADDGAB00 ~~ ADDGAB00
  PC1.y ~~ PC1.y
  PC1 ~~ PC1
"

MCS_glm_all_tip_fit_early <- growth(MCS_lgm_all_tip, 
                           data = mcs_autism_all_tip_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_all_tip_fit_early)


MCS_glm_all_tip_fit_late <- growth(MCS_lgm_all_tip, 
                           data = mcs_autism_all_tip_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_all_tip_fit_late)
```

```{r}
est_MCS_glm_all_tip_fit_early <- parameterEstimates(MCS_glm_all_tip_fit_early) %>% filter(grepl("int|slp",lhs) & op == "~1")
results_MCS_glm_all_tip_fit_early <- est_MCS_glm_all_tip_fit_early %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_MCS_glm_all_tip_fit_early

est_MCS_glm_all_tip_fit_late <- parameterEstimates(MCS_glm_all_tip_fit_late) %>% filter(grepl("int|slp",lhs) & op == "~1")
results_MCS_glm_all_tip_fit_late <- est_MCS_glm_all_tip_fit_late %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_MCS_glm_all_tip_fit_late


```

```{r}
MCS_lgm_all_tip_emo <- "
  int =~ 1*BEMOTION + 1*CEMOTION + 1*DDEMOTION + 1*EEMOTION + 1*FEMOTION + 1*GEMOTION
  slp =~ 0*BEMOTION + 1*CEMOTION + 2*DDEMOTION + 3*EEMOTION + 4*FEMOTION + 5*GEMOTION
  
  int ~ sex_num + PC1.x + ADC11E00 + ADDGAB00 + PC1.y + PC1
  slp ~ sex_num + PC1.x + ADC11E00 + ADDGAB00 + PC1.y + PC1
  
  
  sex_num ~~ sex_num
  PC1.x ~~ PC1.x
  ADC11E00 ~~ ADC11E00
  ADDGAB00 ~~ ADDGAB00
  PC1.y ~~ PC1.y
  PC1 ~~ PC1
"

MCS_glm_all_tip_fit_early_emo <- growth(MCS_lgm_all_tip_emo, 
                           data = mcs_autism_all_tip_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_all_tip_fit_early_emo)


MCS_glm_all_tip_fit_late_emo <- growth(MCS_lgm_all_tip_emo, 
                           data = mcs_autism_all_tip_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_all_tip_fit_late_emo)
```



```{r}
MCS_lgm_all_tip_con <- "
  int =~ 1*BCONDUCT + 1*CCONDUCT + 1*DDCONDUCT + 1*ECONDUCT + 1*FCONDUCT + 1*GCONDUCT
  slp =~ 0*BCONDUCT + 1*CCONDUCT + 2*DDCONDUCT + 3*ECONDUCT + 4*FCONDUCT + 5*GCONDUCT
  
  int ~ sex_num + PC1.x + ADC11E00 + ADDGAB00 + PC1.y + PC1
  slp ~ sex_num + PC1.x + ADC11E00 + ADDGAB00 + PC1.y + PC1
  
  
  sex_num ~~ sex_num
  PC1.x ~~ PC1.x
  ADC11E00 ~~ ADC11E00
  ADDGAB00 ~~ ADDGAB00
  PC1.y ~~ PC1.y
  PC1 ~~ PC1
"

MCS_glm_all_tip_fit_early_con <- growth(MCS_lgm_all_tip_con, 
                           data = mcs_autism_all_tip_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_all_tip_fit_early_con)


MCS_glm_all_tip_fit_late_con <- growth(MCS_lgm_all_tip_con, 
                           data = mcs_autism_all_tip_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_all_tip_fit_late_con)
```
```{r}
MCS_lgm_all_tip_hyper <- "
  int =~ 1*BHYPER + 1*CHYPER + 1*DDHYPER + 1*EHYPER + 1*FHYPER + 1*GHYPER
  slp =~ 0*BHYPER + 1*CHYPER + 2*DDHYPER + 3*EHYPER + 4*FHYPER + 5*GHYPER
  
  int ~ sex_num + PC1.x + ADC11E00 + ADDGAB00 + PC1.y + PC1
  slp ~ sex_num + PC1.x + ADC11E00 + ADDGAB00 + PC1.y + PC1
  
  
  sex_num ~~ sex_num
  PC1.x ~~ PC1.x
  ADC11E00 ~~ ADC11E00
  ADDGAB00 ~~ ADDGAB00
  PC1.y ~~ PC1.y
  PC1 ~~ PC1
"

MCS_glm_all_tip_fit_early_hyper <- growth(MCS_lgm_all_tip_hyper, 
                           data = mcs_autism_all_tip_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_all_tip_fit_early_hyper)


MCS_glm_all_tip_fit_late_hyper <- growth(MCS_lgm_all_tip_hyper, 
                           data = mcs_autism_all_tip_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_all_tip_fit_late_hyper)
```
```{r}
MCS_lgm_all_tip_peer <- "
  int =~ 1*BPEER + 1*CPEER + 1*DDPEER + 1*EPEER + 1*FPEER + 1*GPEER
  slp =~ 0*BPEER + 1*CPEER + 2*DDPEER + 3*EPEER + 4*FPEER + 5*GPEER
  
  int ~ sex_num + PC1.x + ADC11E00 + ADDGAB00 + PC1.y + PC1
  slp ~ sex_num + PC1.x + ADC11E00 + ADDGAB00 + PC1.y + PC1
  
  
  sex_num ~~ sex_num
  PC1.x ~~ PC1.x
  ADC11E00 ~~ ADC11E00
  ADDGAB00 ~~ ADDGAB00
  PC1.y ~~ PC1.y
  PC1 ~~ PC1
"

MCS_glm_all_tip_fit_early_peer <- growth(MCS_lgm_all_tip_peer, 
                           data = mcs_autism_all_tip_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_all_tip_fit_early_peer)


MCS_glm_all_tip_fit_late_peer <- growth(MCS_lgm_all_tip_peer, 
                           data = mcs_autism_all_tip_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_all_tip_fit_late_peer)
```
```{r}
MCS_lgm_all_tip_pro <- "
  int =~ 1*BPROSOC + 1*CPROSOC + 1*DDPROSOC + 1*EPROSOC + 1*FPROSOC + 1*GPROSOC
  slp =~ 0*BPROSOC + 1*CPROSOC + 2*DDPROSOC + 3*EPROSOC + 4*FPROSOC + 5*GPROSOC
  
  int ~ sex_num + PC1.x + ADC11E00 + ADDGAB00 + PC1.y + PC1
  slp ~ sex_num + PC1.x + ADC11E00 + ADDGAB00 + PC1.y + PC1
  
  
  sex_num ~~ sex_num
  PC1.x ~~ PC1.x
  ADC11E00 ~~ ADC11E00
  ADDGAB00 ~~ ADDGAB00
  PC1.y ~~ PC1.y
  PC1 ~~ PC1
"

MCS_glm_all_tip_fit_early_pro <- growth(MCS_lgm_all_tip_pro, 
                           data = mcs_autism_all_tip_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_all_tip_fit_early_pro)


MCS_glm_all_tip_fit_late_pro <- growth(MCS_lgm_all_tip_pro, 
                           data = mcs_autism_all_tip_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_all_tip_fit_late_pro)
```

```{r}
est_MCS_glm_all_tip_fit_early_emo <- parameterEstimates(MCS_glm_all_tip_fit_early_emo) %>% filter(grepl("int|slp",lhs) & op == "~1")
results_MCS_glm_all_tip_fit_early_emo <- est_MCS_glm_all_tip_fit_early_emo %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_MCS_glm_all_tip_fit_early_emo

est_MCS_glm_all_tip_fit_late_emo <- parameterEstimates(MCS_glm_all_tip_fit_late_emo) %>% filter(grepl("int|slp",lhs) & op == "~1")
results_MCS_glm_all_tip_fit_late_emo <- est_MCS_glm_all_tip_fit_late_emo %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_MCS_glm_all_tip_fit_late_emo


```
```{r}
est_MCS_glm_all_tip_fit_early_con <- parameterEstimates(MCS_glm_all_tip_fit_early_con) %>% filter(grepl("int|slp",lhs) & op == "~1")
results_MCS_glm_all_tip_fit_early_con <- est_MCS_glm_all_tip_fit_early_con %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_MCS_glm_all_tip_fit_early_con

est_MCS_glm_all_tip_fit_late_con <- parameterEstimates(MCS_glm_all_tip_fit_late_con) %>% filter(grepl("int|slp",lhs) & op == "~1")
results_MCS_glm_all_tip_fit_late_con <- est_MCS_glm_all_tip_fit_late_con %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_MCS_glm_all_tip_fit_late_con


```
```{r}
est_MCS_glm_all_tip_fit_early_hyp <- parameterEstimates(MCS_glm_all_tip_fit_early_hyper) %>% filter(grepl("int|slp",lhs) & op == "~1")
results_MCS_glm_all_tip_fit_early_hyp <- est_MCS_glm_all_tip_fit_early_hyp %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_MCS_glm_all_tip_fit_early_hyp

est_MCS_glm_all_tip_fit_late_hyp <- parameterEstimates(MCS_glm_all_tip_fit_late_hyper) %>% filter(grepl("int|slp",lhs) & op == "~1")
results_MCS_glm_all_tip_fit_late_hyp <- est_MCS_glm_all_tip_fit_late_hyp %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_MCS_glm_all_tip_fit_late_hyp


```
```{r}
est_MCS_glm_all_tip_fit_early_peer <- parameterEstimates(MCS_glm_all_tip_fit_early_peer) %>% filter(grepl("int|slp",lhs) & op == "~1")
results_MCS_glm_all_tip_fit_early_peer <- est_MCS_glm_all_tip_fit_early_peer %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_MCS_glm_all_tip_fit_early_peer

est_MCS_glm_all_tip_fit_late_peer <- parameterEstimates(MCS_glm_all_tip_fit_late_peer) %>% filter(grepl("int|slp",lhs) & op == "~1")
results_MCS_glm_all_tip_fit_late_peer <- est_MCS_glm_all_tip_fit_late_peer %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_MCS_glm_all_tip_fit_late_peer


```
```{r}
est_MCS_glm_all_tip_fit_early_pro <- parameterEstimates(MCS_glm_all_tip_fit_early_pro) %>% filter(grepl("int|slp",lhs) & op == "~1")
results_MCS_glm_all_tip_fit_early_pro <- est_MCS_glm_all_tip_fit_early_pro %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_MCS_glm_all_tip_fit_early_pro

est_MCS_glm_all_tip_fit_late_pro <- parameterEstimates(MCS_glm_all_tip_fit_late_pro) %>% filter(grepl("int|slp",lhs) & op == "~1")
results_MCS_glm_all_tip_fit_late_pro <- est_MCS_glm_all_tip_fit_late_pro %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_MCS_glm_all_tip_fit_late_pro


```

# Test if adding predictors improved the model fit
```{r}
MCS_lgm_all_tip_test <- "
  int =~ 1*BEBDTOT + 1*CEBDTOT + 1*DDDEBDTOT + 1*EEBDTOT + 1*FEBDTOT + 1*GEBDTOT
  slp =~ 0*BEBDTOT + 1*CEBDTOT + 2*DDDEBDTOT + 3*EEBDTOT + 4*FEBDTOT + 5*GEBDTOT
  
  BEBDTOT ~~ a*BEBDTOT
  CEBDTOT ~~ a*CEBDTOT
  DDDEBDTOT ~~ a*DDDEBDTOT
  EEBDTOT ~~ a*EEBDTOT
  FEBDTOT ~~ a*FEBDTOT
  GEBDTOT ~~ a*GEBDTOT
  

  int ~ 0*sex_num + 0*PC1.x + 0*ADC11E00 + 0*ADDGAB00 + 0*PC1.y + 0*PC1
  slp ~ 0*sex_num + 0*PC1.x + 0*ADC11E00 + 0*ADDGAB00 + 0*PC1.y + 0*PC1
"

MCS_glm_all_tip_fit_early_test <- growth(MCS_lgm_all_tip_test, 
                           data = mcs_autism_all_tip_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_all_tip_fit_early_test)


MCS_glm_all_tip_fit_late_test <- growth(MCS_lgm_all_tip_test, 
                           data = mcs_autism_all_tip_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(MCS_glm_all_tip_fit_late_test)
```
```{r}
anova(MCS_glm_all_tip_fit_early,MCS_glm_all_tip_fit_early_test)
anova(MCS_glm_all_tip_fit_late,MCS_glm_all_tip_fit_late_test)
```