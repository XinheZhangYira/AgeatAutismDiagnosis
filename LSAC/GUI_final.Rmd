---
title: "GUI_final"
author: "Yira Zhang"
date: "2023-10-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Packages
```{r}
library(haven)
library(dplyr)
library(gee)
library(data.table)
library(gee)
library(stats)
library(tidyverse)
library(geepack)
library(Hmisc)
library(corrplot)
library(gridExtra)
```

```{r}
colorize <- function(x, color) {
  if (knitr::is_latex_output()) {
    sprintf("\\textcolor{%s}{%s}", color, x)
  } else if (knitr::is_html_output()) {
    sprintf("<span style='color: %s;'>%s</span>", color,
      x)
  } else x
}
```

## Prepare the data
```{r}

CC_wave1 <- read_dta("/Users/zhangxinhe/Documents/who recieves a diagnosis/Born_in_Ireland/0020-00 GUI_Child_Waves_1_2_3_4/0020-01 GUI Child Cohort Wave 1/0020-01 GUI Child Cohort Wave 1_Data/9 Year Cohort Data/Stata/GUI Data_9YearCohort.dta")
CC_wave2 <- read_dta("/Users/zhangxinhe/Documents/who recieves a diagnosis/Born_in_Ireland/0020-00 GUI_Child_Waves_1_2_3_4/0020-02 GUI Child Cohort Wave 2/0020-02 GUI Child Cohort Wave 2_Data/13 year cohort data/Stata/GUI Data_ChildCohortWave2.dta")
CC_wave3 <- read_dta("/Users/zhangxinhe/Documents/who recieves a diagnosis/Born_in_Ireland/0020-00 GUI_Child_Waves_1_2_3_4/0020-03 GUI Child Cohort Wave 3 revised/0020-03 GUI Child Cohort Wave 3_Data revised/Stata/0020-03_GUI_Data_ChildCohortWave3_V1.3.dta")
CC_wave4 <- read_dta("/Users/zhangxinhe/Documents/who recieves a diagnosis/Born_in_Ireland/0020-00 GUI_Child_Waves_1_2_3_4/0020-04 GUI Child Cohort Wave 4/0020-04 GUI Child Cohort Wave 4_Data/STATA/0020-04_GUI_Data_ChildCohortWave4.dta")



# wave1 = 9 years
# wave2 = 13 years
# wave3 = 17/18 years
# wave4 = 20 years
```

## Autism diagnosis
```{r}

ireland_consistent_ID <- unique(CC_wave3$ID[CC_wave3$ID %in% CC_wave2$id[CC_wave2$id %in% CC_wave1$ID]])

CC_cons_1 <- as.data.frame(CC_wave1 %>% filter(ID %in% ireland_consistent_ID))
CC_cons_2 <- as.data.frame(CC_wave2 %>% filter(id %in% CC_cons_1$ID))
CC_cons_3 <- as.data.frame(CC_wave3 %>% filter(ID %in% CC_cons_1$ID))


``` 

```{r}
CC_wave1_autism_diagnosis <- CC_cons_1 %>% filter(MMJ22c == 1)
nrow(CC_wave1_autism_diagnosis)
# lacking of a specific diagnosis age, but had diagnosis age indicated in periods
CC_wave2_autism_diagnosis <- CC_cons_2 %>% filter(pc2e15d == 1)
nrow(CC_wave2_autism_diagnosis)

CC_wave3_autism_diagnosis <- CC_cons_3 %>% filter(pc3d3d == 1)
nrow(CC_wave3_autism_diagnosis)
# the wording has become "autism spectrum disorders (e.g. autism, aspergers syndrome)"

# Child cohort wave4 did not ask for autism diagnosis information
```

```{r}
table(CC_wave1_autism_diagnosis$mma5ap2) 

table(CC_wave2_autism_diagnosis$p2sexw2)
table(CC_wave3_autism_diagnosis$p2sexW3)

# 1 = male; 2 = female
table(CC_wave1_autism_diagnosis$MMJ24) # missing 5/39
table(CC_wave2_autism_diagnosis$pc2e17d)# missing 2/55
table(CC_wave3_autism_diagnosis$pc3d5d) # 10/ 90
```

# Descriptives

```{r}
# n = 5958
GUI_SDQ <- as.data.frame(cbind(CC_cons_1$ID,  CC_cons_1$mma5ap2,    CC_cons_1$MMJ22c,CC_cons_2$pc2e15d,CC_cons_3$pc3d3d,            CC_cons_1$MMH2_SDQemot,CC_cons_1$MMH2_SDQcond,CC_cons_1$MMH2_SDQhyper,CC_cons_1$MMH2_SDQpeer,CC_cons_1$MMH2_SDQpro, CC_cons_1$MMH2_SDQtot,
                                CC_cons_2$w2pcd2_sdqemot,CC_cons_2$w2pcd2_sdqcond,CC_cons_2$w2pcd2_sdqhyper,CC_cons_2$w2pcd2_sdqpeer, CC_cons_2$w2pcd2_sdqpro,CC_cons_2$w2pcd2_sdqtot,
                                CC_cons_3$w3pcg_SDQemotional,CC_cons_3$w3pcg_SDQconduct,CC_cons_3$w3pcg_SDQhyper,CC_cons_3$w3pcg_SDQpeerprobs,CC_cons_3$w3pcg_SDQprosocial,CC_cons_3$w3pcg_SDQtotaldiffs))

colnames(GUI_SDQ) =  c('Idnumber','sex','w1_autism','w2_autism','w3_autism','w1_emo','w1_con','w1_hyp','w1_peer','w1_pro','w1_total','w2_emo','w2_con','w2_hyp','w2_peer','w2_pro','w2_total','w3_emo','w3_con','w3_hyp','w3_peer','w3_pro','w3_total')

GUI_SDQ$w1_autism[is.na(GUI_SDQ$w1_autism)] <- 2
GUI_SDQ$w2_autism[is.na(GUI_SDQ$w2_autism)] <- 2
GUI_SDQ$w3_autism[is.na(GUI_SDQ$w3_autism)] <- 2
#GUI_SDQ$w1_adhd[is.na(GUI_SDQ$w1_adhd)] <- 2
#GUI_SDQ$w2_adhd[is.na(GUI_SDQ$w2_adhd)] <- 2
#GUI_SDQ$w3_adhd[is.na(GUI_SDQ$w3_adhd)] <- 2




GUI_SDQ <- GUI_SDQ %>% filter_all(all_vars(. >= 0))
GUI_SDQ$w1_int <- GUI_SDQ$w1_pro + GUI_SDQ$w1_peer
GUI_SDQ$w1_ext <- GUI_SDQ$w1_con + GUI_SDQ$w1_hyp
GUI_SDQ$w2_int <- GUI_SDQ$w2_pro + GUI_SDQ$w2_peer
GUI_SDQ$w2_ext <- GUI_SDQ$w2_con + GUI_SDQ$w2_hyp
GUI_SDQ$w3_int <- GUI_SDQ$w3_pro + GUI_SDQ$w3_peer
GUI_SDQ$w3_ext <- GUI_SDQ$w3_con + GUI_SDQ$w3_hyp

```


```{r}

GUI_SDQ_no_diag <- GUI_SDQ[GUI_SDQ$w1_autism == 2 & GUI_SDQ$w2_autism == 2 & GUI_SDQ$w3_autism == 2 ,] # n = 5843

GUI_SDQ_autism <- GUI_SDQ[GUI_SDQ$w1_autism == 1|GUI_SDQ$w2_autism == 1|GUI_SDQ$w3_autism == 1,] # n = 109


```

```{r}
selected_columns <- c("w1_autism", "w2_autism", "w3_autism")
GUI_SDQ_autism$autism_pattern <- do.call(paste, c(GUI_SDQ_autism[selected_columns], sep = "-"))
find_first_one_position <- function(pattern) {
  pattern_digits <- unlist(strsplit(pattern, "-"))
  first_one_position <- which(pattern_digits == "1")[1]
  return(first_one_position)
}

# Apply the function to each row in the dataframe and create a new column
GUI_SDQ_autism$first_diag <- sapply(GUI_SDQ_autism$autism_pattern, find_first_one_position)


```

```{r}
GUI_SDQ_autism <- GUI_SDQ_autism %>%
  mutate(diag.age = case_when(
    first_diag == 1 ~ 9,
    first_diag == 2 ~ 13,
    first_diag == 3 ~ 17
    )
    )
GUI_SDQ_autism$group <- ifelse(GUI_SDQ_autism$first_diag == 1, 1, 2)
```

```{r}

gui_xtab <- xtabs(~ diag.age + sex,data = GUI_SDQ_autism)
gui_xtab
```

```{r}
GUI_SDQ_no_diag$group <- 3

GUI_SDQ_all <- rbind(GUI_SDQ_autism[,c(1:29,33)],GUI_SDQ_no_diag)

```


```{r}

GUI_SDQ_autism_early <- GUI_SDQ_autism[GUI_SDQ_autism$diag.age == 9,]
GUI_SDQ_autism_late <- GUI_SDQ_autism[GUI_SDQ_autism$diag.age %in% c(13,17),]

```

## Trajectory graphs
# SDQ Total
```{r}

GUI_autism_total_early <- GUI_SDQ_autism_early[,c(1:2,11,17,23)]
colnames(GUI_autism_total_early)[3:5] = c("w1","w2","w3")
GUI_autism_total_early_long <- melt(setDT(GUI_autism_total_early), id.vars = c("Idnumber","sex"), variable.name = "sweep")

```
```{r}

GUI_autism_total_early_mean <- 
 GUI_autism_total_early_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)
GUI_autism_total_early_long$group <- "early"
```

```{r}
age <- c("9","13","17/18")
CC_autism_b9_indi_gt <- GUI_autism_total_early_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_autism_b9_indi_gt
  
CC_autism_b9_mean_gt <-ggplot(data=GUI_autism_total_early_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_autism_b9_mean_gt

CC_autism_b9_indi_mean_gt <- GUI_autism_total_early_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_autism_total_early_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_autism_b9_indi_mean_gt + scale_x_discrete(labels= age) + labs(y = "SDQ score", x = "age(years)")

```
```{r}

GUI_autism_total_late <- GUI_SDQ_autism_late[,c(1:2,11,17,23)]
colnames(GUI_autism_total_late)[3:5] = c("w1","w2","w3")
GUI_autism_total_late_long <- melt(setDT(GUI_autism_total_late), id.vars = c("Idnumber","sex"), variable.name = "sweep")



GUI_autism_total_late_mean <- 
 GUI_autism_total_late_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)
GUI_autism_total_late_long$group <- "late"
```

```{r,eval=FALSE}

CC_autism_a9_indi_gt <- GUI_autism_total_late_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_autism_a9_indi_gt
  
CC_autism_a9_mean_gt <-ggplot(data=GUI_autism_total_late_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_autism_a9_mean_gt

CC_autism_a9_indi_mean_gt <- GUI_autism_total_late_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_autism_total_late_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_autism_a9_indi_mean_gt+ scale_x_discrete(labels= age) + labs(y = "SDQ score", x = "age(years)")

```
```{r}

GUI_no_diag_sdq_total <- GUI_SDQ_no_diag[,c(1:2,11,17,23)]
colnames(GUI_no_diag_sdq_total)[3:5] = c("w1","w2","w3")
GUI_no_diag_sdq_total_long <- melt(setDT(GUI_no_diag_sdq_total), id.vars = c("Idnumber","sex"), variable.name = "sweep")



GUI_no_diag_sdq_total_mean <- 
 GUI_no_diag_sdq_total_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)

GUI_no_diag_sdq_total_long$group <- "no_diag"
```

```{r, eval = F}

CC_no_diag_indi_gt <- GUI_no_diag_sdq_total_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_no_diag_indi_gt
  
CC_no_diag_mean_gt <-ggplot(data=GUI_no_diag_sdq_total_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_no_diag_mean_gt

CC_no_diag_indi_mean_gt <- GUI_no_diag_sdq_total_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_no_diag_sdq_total_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_no_diag_indi_mean_gt+ scale_x_discrete(labels= age) + labs(y = "SDQ score", x = "age(years)") 
```

```{r}

GUI_autism_total_late_summary <- GUI_autism_total_late_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    ttl_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_autism_total_late_summary$group <- "late"
GUI_autism_total_late_summary$lb <- GUI_autism_total_late_summary$ttl_mean - 1.96*GUI_autism_total_late_summary$se
GUI_autism_total_late_summary$ub <- GUI_autism_total_late_summary$ttl_mean + 1.96*GUI_autism_total_late_summary$se
GUI_autism_total_late_summary


GUI_autism_total_early_summary <- GUI_autism_total_early_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    ttl_mean = mean(value),
     se = plotrix::std.error(value)
  )

GUI_autism_total_early_summary$group <- "early"
GUI_autism_total_early_summary$lb <- GUI_autism_total_early_summary$ttl_mean - 1.96*GUI_autism_total_early_summary$se
GUI_autism_total_early_summary$ub <- GUI_autism_total_early_summary$ttl_mean + 1.96*GUI_autism_total_early_summary$se
GUI_autism_total_early_summary


GUI_no_diag_sdq_total_summary <- GUI_no_diag_sdq_total_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    ttl_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_no_diag_sdq_total_summary$group <- "no_diag"
GUI_no_diag_sdq_total_summary$lb <- GUI_no_diag_sdq_total_summary$ttl_mean - 1.96*GUI_no_diag_sdq_total_summary$se
GUI_no_diag_sdq_total_summary$ub <- GUI_no_diag_sdq_total_summary$ttl_mean + 1.96*GUI_no_diag_sdq_total_summary$se
GUI_no_diag_sdq_total_summary
```



```{r}
ireland_age_break <- c("9","13","17/18")
ireland_sdq_ttl_mean_full <- full_join(full_join(GUI_autism_total_early_summary, GUI_autism_total_late_summary), GUI_no_diag_sdq_total_summary)

p <- ggplot(ireland_sdq_ttl_mean_full, aes(x = as.numeric(sweep), y = ttl_mean, colour = group)) + geom_line(data = ireland_sdq_ttl_mean_full, aes(x = as.numeric(sweep), y = ttl_mean, colour = group)) + geom_point() 

p
breaks = seq(min(as.numeric(GUI_autism_total_early_summary$sweep)),max(as.numeric(GUI_autism_total_early_summary$sweep)), length.out = 3)

my_colors <- brewer.pal(12, "Paired")[c(2,8,4)]
ireland_full_ttl_in_display <- p+geom_ribbon(data = ireland_sdq_ttl_mean_full, aes(x = as.numeric(sweep),ymin = lb, ymax = ub), linetype = 2, alpha = 0.2) + scale_x_continuous(breaks = breaks ,labels= ireland_age_break) + labs(y = "GUI SDQ Total Score", x = "Age (years)")+ theme_classic() + scale_colour_manual(values = my_colors) + theme(legend.position = "none")
ireland_full_ttl_in_display

```




# Emotional symptoms
```{r}

GUI_autism_emo_early <- GUI_SDQ_autism_early[,c(1:2,6,12,18)]
colnames(GUI_autism_emo_early)[3:5] = c("w1","w2","w3")
GUI_autism_emo_early_long <- melt(setDT(GUI_autism_emo_early), id.vars = c("Idnumber","sex"), variable.name = "sweep")


GUI_autism_emo_early_mean <- 
 GUI_autism_emo_early_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)
GUI_autism_emo_early_long$group <- "early"
```

```{r}
age <- c("9","13","17/18")
CC_autism_b9_indi_gt <- GUI_autism_emo_early_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_autism_b9_indi_gt
  
CC_autism_b9_mean_gt <-ggplot(data=GUI_autism_emo_early_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_autism_b9_mean_gt

CC_autism_b9_indi_mean_gt <- GUI_autism_emo_early_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_autism_emo_early_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_autism_b9_indi_mean_gt + scale_x_discrete(labels= age) + labs(y = "SDQ score", x = "age(years)")

```
```{r}

GUI_autism_emo_late <- GUI_SDQ_autism_late[,c(1:2,6,12,18)]
colnames(GUI_autism_emo_late)[3:5] = c("w1","w2","w3")
GUI_autism_emo_late_long <- melt(setDT(GUI_autism_emo_late), id.vars = c("Idnumber","sex"), variable.name = "sweep")


GUI_autism_emo_late_mean <- 
 GUI_autism_emo_late_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)
GUI_autism_emo_late_long$group <- "late"
```

```{r}

CC_autism_a9_indi_gt <- GUI_autism_emo_late_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_autism_a9_indi_gt
  
CC_autism_a9_mean_gt <-ggplot(data=GUI_autism_emo_late_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_autism_a9_mean_gt

CC_autism_a9_indi_mean_gt <- GUI_autism_emo_late_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_autism_emo_late_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_autism_a9_indi_mean_gt+ scale_x_discrete(labels= age) + labs(y = "SDQ score", x = "age(years)")

```
```{r}

GUI_no_diag_sdq_emo <- GUI_SDQ_no_diag[,c(1:2,6,12,18)]
colnames(GUI_no_diag_sdq_emo)[3:5] = c("w1","w2","w3")
GUI_no_diag_sdq_emo_long <- melt(setDT(GUI_no_diag_sdq_emo), id.vars = c("Idnumber","sex"), variable.name = "sweep")


GUI_no_diag_sdq_emo_mean <- 
 GUI_no_diag_sdq_emo_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)

GUI_no_diag_sdq_emo_long$group <- "no_diag"
```

```{r}

CC_no_diag_indi_gt <- GUI_no_diag_sdq_emo_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_no_diag_indi_gt
  
CC_no_diag_mean_gt <-ggplot(data=GUI_no_diag_sdq_emo_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_no_diag_mean_gt

CC_no_diag_indi_mean_gt <- GUI_no_diag_sdq_emo_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_no_diag_sdq_emo_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_no_diag_indi_mean_gt+ scale_x_discrete(labels= age) + labs(y = "SDQ score", x = "age(years)") 

```

```{r}

GUI_autism_emo_late_summary <- GUI_autism_emo_late_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    emo_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_autism_emo_late_summary$group <- "late"
GUI_autism_emo_late_summary$lb <- GUI_autism_emo_late_summary$emo_mean - 1.96*GUI_autism_emo_late_summary$se
GUI_autism_emo_late_summary$ub <- GUI_autism_emo_late_summary$emo_mean + 1.96*GUI_autism_emo_late_summary$se
GUI_autism_emo_late_summary


GUI_autism_emo_early_summary <- GUI_autism_emo_early_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    emo_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_autism_emo_early_summary$group <- "early"
GUI_autism_emo_early_summary$lb <- GUI_autism_emo_early_summary$emo_mean - 1.96*GUI_autism_emo_early_summary$se
GUI_autism_emo_early_summary$ub <- GUI_autism_emo_early_summary$emo_mean + 1.96*GUI_autism_emo_early_summary$se
GUI_autism_emo_early_summary


GUI_no_diag_sdq_emo_summary <- GUI_no_diag_sdq_emo_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    emo_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_no_diag_sdq_emo_summary$group <- "no_diag"
GUI_no_diag_sdq_emo_summary$lb <- GUI_no_diag_sdq_emo_summary$emo_mean - 1.96*GUI_no_diag_sdq_emo_summary$se
GUI_no_diag_sdq_emo_summary$ub <- GUI_no_diag_sdq_emo_summary$emo_mean + 1.96*GUI_no_diag_sdq_emo_summary$se
GUI_no_diag_sdq_emo_summary
```



```{r}
ireland_age_break <- c("9","13","17/18")
ireland_sdq_emo_mean_full <- full_join(full_join(GUI_autism_emo_early_summary, GUI_autism_emo_late_summary), GUI_no_diag_sdq_emo_summary)

p <- ggplot(ireland_sdq_emo_mean_full, aes(x = as.numeric(sweep), y = emo_mean, colour = group)) + geom_line(data = ireland_sdq_emo_mean_full, aes(x = as.numeric(sweep), y = emo_mean, colour = group)) + geom_point() 

p
breaks = seq(min(as.numeric(GUI_autism_emo_early_summary$sweep)),max(as.numeric(GUI_autism_emo_early_summary$sweep)), length.out = 3)

ireland_full_emo_in_display <- p+geom_ribbon(data = ireland_sdq_emo_mean_full, aes(x = as.numeric(sweep),ymin = lb, ymax = ub), linetype = 2, alpha = 0.2) + scale_x_continuous(breaks = breaks ,labels= ireland_age_break) + labs(y = "GUI SDQ Emotional Symptoms Score", x = "Age (years)")+ theme_classic()+ scale_colour_manual(values = my_colors) + theme(legend.position = "none")
ireland_full_emo_in_display

```


# Conduct problems

```{r}

GUI_autism_con_early <- GUI_SDQ_autism_early[,c(1:2,7,13,19)]
colnames(GUI_autism_con_early)[3:5] = c("w1","w2","w3")
GUI_autism_con_early_long <- melt(setDT(GUI_autism_con_early), id.vars = c("Idnumber","sex"), variable.name = "sweep")



GUI_autism_con_early_mean <- 
 GUI_autism_con_early_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)
GUI_autism_con_early_long$group <- "early"

age <- c("9","13","17/18")
CC_autism_b9_indi_gt <- GUI_autism_con_early_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_autism_b9_indi_gt
  
CC_autism_b9_mean_gt <-ggplot(data=GUI_autism_con_early_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_autism_b9_mean_gt

CC_autism_b9_indi_mean_gt <- GUI_autism_con_early_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_autism_con_early_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_autism_b9_indi_mean_gt + scale_x_discrete(labels= age) + labs(y = "SDQ Conduct Problem Score", x = "age(years)")

```
```{r}

GUI_autism_con_late <- GUI_SDQ_autism_late[,c(1:2,7,13,19)]
colnames(GUI_autism_con_late)[3:5] = c("w1","w2","w3")
GUI_autism_con_late_long <- melt(setDT(GUI_autism_con_late), id.vars = c("Idnumber","sex"), variable.name = "sweep")



GUI_autism_con_late_mean <- 
 GUI_autism_con_late_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)
GUI_autism_con_late_long$group <- "late"


CC_autism_a9_indi_gt <- GUI_autism_con_late_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_autism_a9_indi_gt
  
CC_autism_a9_mean_gt <-ggplot(data=GUI_autism_con_late_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_autism_a9_mean_gt

CC_autism_a9_indi_mean_gt <- GUI_autism_con_late_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_autism_con_late_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_autism_a9_indi_mean_gt+ scale_x_discrete(labels= age) + labs(y = "SDQ Conduct Problem Score", x = "age(years)")



GUI_no_diag_sdq_con <- GUI_SDQ_no_diag[,c(1:2,7,13,19)]
colnames(GUI_no_diag_sdq_con)[3:5] = c("w1","w2","w3")
GUI_no_diag_sdq_con_long <- melt(setDT(GUI_no_diag_sdq_con), id.vars = c("Idnumber","sex"), variable.name = "sweep")


GUI_no_diag_sdq_con_mean <- 
 GUI_no_diag_sdq_con_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)

GUI_no_diag_sdq_con_long$group <- "no_diag"


CC_no_diag_indi_gt <- GUI_no_diag_sdq_con_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_no_diag_indi_gt
  
CC_no_diag_mean_gt <-ggplot(data=GUI_no_diag_sdq_con_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_no_diag_mean_gt

CC_no_diag_indi_mean_gt <- GUI_no_diag_sdq_con_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_no_diag_sdq_con_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_no_diag_indi_mean_gt+ scale_x_discrete(labels= age) + labs(y = "SDQ Conduct Problem Score", x = "age(years)") 

```

```{r}

GUI_autism_con_late_summary <- GUI_autism_con_late_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    con_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_autism_con_late_summary$group <- "late"
GUI_autism_con_late_summary$lb <- GUI_autism_con_late_summary$con_mean - 1.96*GUI_autism_con_late_summary$se
GUI_autism_con_late_summary$ub <- GUI_autism_con_late_summary$con_mean + 1.96*GUI_autism_con_late_summary$se
GUI_autism_con_late_summary


GUI_autism_con_early_summary <- GUI_autism_con_early_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    con_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_autism_con_early_summary$group <- "early"
GUI_autism_con_early_summary$lb <- GUI_autism_con_early_summary$con_mean - 1.96*GUI_autism_con_early_summary$se
GUI_autism_con_early_summary$ub <- GUI_autism_con_early_summary$con_mean + 1.96*GUI_autism_con_early_summary$se
GUI_autism_con_early_summary


GUI_no_diag_sdq_con_summary <- GUI_no_diag_sdq_con_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    con_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_no_diag_sdq_con_summary$group <- "no_diag"
GUI_no_diag_sdq_con_summary$lb <- GUI_no_diag_sdq_con_summary$con_mean - 1.96*GUI_no_diag_sdq_con_summary$se
GUI_no_diag_sdq_con_summary$ub <- GUI_no_diag_sdq_con_summary$con_mean + 1.96*GUI_no_diag_sdq_con_summary$se
GUI_no_diag_sdq_con_summary
```



```{r}
ireland_age_break <- c("9","13","17/18")
ireland_sdq_con_mean_full <- full_join(full_join(GUI_autism_con_early_summary, GUI_autism_con_late_summary), GUI_no_diag_sdq_con_summary)

p <- ggplot(ireland_sdq_con_mean_full, aes(x = as.numeric(sweep), y = con_mean, colour = group)) + geom_line(data = ireland_sdq_con_mean_full, aes(x = as.numeric(sweep), y = con_mean, colour = group)) + geom_point() 

p
breaks = seq(min(as.numeric(GUI_autism_con_early_summary$sweep)),max(as.numeric(GUI_autism_con_early_summary$sweep)), length.out = 3)

ireland_full_con_in_display <- p+geom_ribbon(data = ireland_sdq_con_mean_full, aes(x = as.numeric(sweep),ymin = lb, ymax = ub), linetype = 2, alpha = 0.2) + scale_x_continuous(breaks = breaks ,labels= ireland_age_break) + labs(y = "GUI SDQ Conduct Problems Score", x = "Age (years)") + theme_classic()+scale_colour_manual(values = my_colors)+ theme(legend.position = "none")

ireland_full_con_in_display

```



# Hyperactivity

```{r}

GUI_autism_hyp_early <- GUI_SDQ_autism_early[,c(1:2,8,14,20)]
colnames(GUI_autism_hyp_early)[3:5] = c("w1","w2","w3")
GUI_autism_hyp_early_long <- melt(setDT(GUI_autism_hyp_early), id.vars = c("Idnumber","sex"), variable.name = "sweep")


GUI_autism_hyp_early_mean <- 
 GUI_autism_hyp_early_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)
GUI_autism_hyp_early_long$group <- "early"

age <- c("9","13","17/18")
CC_autism_b9_indi_gt <- GUI_autism_hyp_early_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_autism_b9_indi_gt
  
CC_autism_b9_mean_gt <-ggplot(data=GUI_autism_hyp_early_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_autism_b9_mean_gt

CC_autism_b9_indi_mean_gt <- GUI_autism_hyp_early_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_autism_hyp_early_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_autism_b9_indi_mean_gt + scale_x_discrete(labels= age) + labs(y = "SDQ  Hyperactivity Score", x = "age(years)")

```
```{r}

GUI_autism_hyp_late <- GUI_SDQ_autism_late[,c(1:2,8,14,20)]
colnames(GUI_autism_hyp_late)[3:5] = c("w1","w2","w3")
GUI_autism_hyp_late_long <- melt(setDT(GUI_autism_hyp_late), id.vars = c("Idnumber","sex"), variable.name = "sweep")



GUI_autism_hyp_late_mean <- 
 GUI_autism_hyp_late_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)
GUI_autism_hyp_late_long$group <- "late"


CC_autism_a9_indi_gt <- GUI_autism_hyp_late_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_autism_a9_indi_gt
  
CC_autism_a9_mean_gt <-ggplot(data=GUI_autism_hyp_late_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_autism_a9_mean_gt

CC_autism_a9_indi_mean_gt <- GUI_autism_hyp_late_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_autism_hyp_late_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_autism_a9_indi_mean_gt+ scale_x_discrete(labels= age) + labs(y = "SDQ  Hyperactivity Score", x = "age(years)")

```
```{r}

GUI_no_diag_sdq_hyp <- GUI_SDQ_no_diag[,c(1:2,8,14,20)]
colnames(GUI_no_diag_sdq_hyp)[3:5] = c("w1","w2","w3")
GUI_no_diag_sdq_hyp_long <- melt(setDT(GUI_no_diag_sdq_hyp), id.vars = c("Idnumber","sex"), variable.name = "sweep")



GUI_no_diag_sdq_hyp_mean <- 
 GUI_no_diag_sdq_hyp_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)

GUI_no_diag_sdq_hyp_long$group <- "no_diag"

CC_no_diag_indi_gt <- GUI_no_diag_sdq_hyp_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_no_diag_indi_gt
  
CC_no_diag_mean_gt <-ggplot(data=GUI_no_diag_sdq_hyp_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_no_diag_mean_gt

CC_no_diag_indi_mean_gt <- GUI_no_diag_sdq_hyp_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_no_diag_sdq_hyp_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_no_diag_indi_mean_gt+ scale_x_discrete(labels= age) + labs(y = "SDQ  Hyperactivity Score", x = "age(years)")

```

```{r}

GUI_autism_hyp_late_summary <- GUI_autism_hyp_late_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    hyp_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_autism_hyp_late_summary$group <- "late"
GUI_autism_hyp_late_summary$lb <- GUI_autism_hyp_late_summary$hyp_mean - 1.96*GUI_autism_hyp_late_summary$se
GUI_autism_hyp_late_summary$ub <- GUI_autism_hyp_late_summary$hyp_mean + 1.96*GUI_autism_hyp_late_summary$se
GUI_autism_hyp_late_summary


GUI_autism_hyp_early_summary <- GUI_autism_hyp_early_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    hyp_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_autism_hyp_early_summary$group <- "early"
GUI_autism_hyp_early_summary$lb <- GUI_autism_hyp_early_summary$hyp_mean - 1.96*GUI_autism_hyp_early_summary$se
GUI_autism_hyp_early_summary$ub <- GUI_autism_hyp_early_summary$hyp_mean + 1.96*GUI_autism_hyp_early_summary$se
GUI_autism_hyp_early_summary


GUI_no_diag_sdq_hyp_summary <- GUI_no_diag_sdq_hyp_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    hyp_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_no_diag_sdq_hyp_summary$group <- "no_diag"
GUI_no_diag_sdq_hyp_summary$lb <- GUI_no_diag_sdq_hyp_summary$hyp_mean - 1.96*GUI_no_diag_sdq_hyp_summary$se
GUI_no_diag_sdq_hyp_summary$ub <- GUI_no_diag_sdq_hyp_summary$hyp_mean + 1.96*GUI_no_diag_sdq_hyp_summary$se
GUI_no_diag_sdq_hyp_summary
```



```{r}
ireland_age_break <- c("9","13","17/18")
ireland_sdq_hyp_mean_full <- full_join(full_join(GUI_autism_hyp_early_summary, GUI_autism_hyp_late_summary), GUI_no_diag_sdq_hyp_summary)

p <- ggplot(ireland_sdq_hyp_mean_full, aes(x = as.numeric(sweep), y = hyp_mean, colour = group)) + geom_line(data = ireland_sdq_hyp_mean_full, aes(x = as.numeric(sweep), y = hyp_mean, colour = group)) + geom_point() 

p
breaks = seq(min(as.numeric(GUI_autism_hyp_early_summary$sweep)),max(as.numeric(GUI_autism_hyp_early_summary$sweep)), length.out = 3)

ireland_full_hyp_in_display <- p+geom_ribbon(data = ireland_sdq_hyp_mean_full, aes(x = as.numeric(sweep),ymin = lb, ymax = ub), linetype = 2, alpha = 0.2) + scale_x_continuous(breaks = breaks ,labels= ireland_age_break) + labs(y = "GUI SDQ Hyperactivity-Inattention Score", x = "Age (years)") + theme_classic() + scale_colour_manual(values = my_colors)+ theme(legend.position = "none")

ireland_full_hyp_in_display

```


# Peer relationship

```{r}

GUI_autism_peer_early <- GUI_SDQ_autism_early[,c(1:2,9,15,21)]
colnames(GUI_autism_peer_early)[3:5] = c("w1","w2","w3")
GUI_autism_peer_early_long <- melt(setDT(GUI_autism_peer_early), id.vars = c("Idnumber","sex"), variable.name = "sweep")



GUI_autism_peer_early_mean <- 
 GUI_autism_peer_early_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)
GUI_autism_peer_early_long$group <- "early"
```

```{r}
age <- c("9","13","17/18")
CC_autism_b9_indi_gt <- GUI_autism_peer_early_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_autism_b9_indi_gt
  
CC_autism_b9_mean_gt <-ggplot(data=GUI_autism_peer_early_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_autism_b9_mean_gt

CC_autism_b9_indi_mean_gt <- GUI_autism_peer_early_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_autism_peer_early_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_autism_b9_indi_mean_gt + scale_x_discrete(labels= age) + labs(y = "SDQ Peer Relationship Score", x = "age(years)")

```
```{r}

GUI_autism_peer_late <- GUI_SDQ_autism_late[,c(1:2,9,15,21)]
colnames(GUI_autism_peer_late)[3:5] = c("w1","w2","w3")
GUI_autism_peer_late_long <- melt(setDT(GUI_autism_peer_late), id.vars = c("Idnumber","sex"), variable.name = "sweep")


GUI_autism_peer_late_mean <- 
 GUI_autism_peer_late_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)
GUI_autism_peer_late_long$group <- "late"
```

```{r}

CC_autism_a9_indi_gt <- GUI_autism_peer_late_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_autism_a9_indi_gt
  
CC_autism_a9_mean_gt <-ggplot(data=GUI_autism_peer_late_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_autism_a9_mean_gt

CC_autism_a9_indi_mean_gt <- GUI_autism_peer_late_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_autism_peer_late_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_autism_a9_indi_mean_gt+ scale_x_discrete(labels= age) + labs(y = "SDQ Peer Relationship Score", x = "age(years)")

```
```{r}

GUI_no_diag_sdq_peer <- GUI_SDQ_no_diag[,c(1:2,9,15,21)]
colnames(GUI_no_diag_sdq_peer)[3:5] = c("w1","w2","w3")
GUI_no_diag_sdq_peer_long <- melt(setDT(GUI_no_diag_sdq_peer), id.vars = c("Idnumber","sex"), variable.name = "sweep")


GUI_no_diag_sdq_peer_mean <- 
 GUI_no_diag_sdq_peer_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)

GUI_no_diag_sdq_peer_long$group <- "no_diag"
```

```{r}

CC_no_diag_indi_gt <- GUI_no_diag_sdq_peer_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_no_diag_indi_gt
  
CC_no_diag_mean_gt <-ggplot(data=GUI_no_diag_sdq_peer_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_no_diag_mean_gt

CC_no_diag_indi_mean_gt <- GUI_no_diag_sdq_peer_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_no_diag_sdq_peer_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_no_diag_indi_mean_gt+ scale_x_discrete(labels= age) + labs(y = "SDQ Peer Relationship Score", x = "age(years)") 

```

```{r}

GUI_autism_peer_late_summary <- GUI_autism_peer_late_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    peer_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_autism_peer_late_summary$group <- "late"
GUI_autism_peer_late_summary$lb <- GUI_autism_peer_late_summary$peer_mean - 1.96*GUI_autism_peer_late_summary$se
GUI_autism_peer_late_summary$ub <- GUI_autism_peer_late_summary$peer_mean + 1.96*GUI_autism_peer_late_summary$se
GUI_autism_peer_late_summary


GUI_autism_peer_early_summary <- GUI_autism_peer_early_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    peer_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_autism_peer_early_summary$group <- "early"
GUI_autism_peer_early_summary$lb <- GUI_autism_peer_early_summary$peer_mean - 1.96*GUI_autism_peer_early_summary$se
GUI_autism_peer_early_summary$ub <- GUI_autism_peer_early_summary$peer_mean + 1.96*GUI_autism_peer_early_summary$se
GUI_autism_peer_early_summary


GUI_no_diag_sdq_peer_summary <- GUI_no_diag_sdq_peer_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    peer_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_no_diag_sdq_peer_summary$group <- "no_diag"
GUI_no_diag_sdq_peer_summary$lb <- GUI_no_diag_sdq_peer_summary$peer_mean - 1.96*GUI_no_diag_sdq_peer_summary$se
GUI_no_diag_sdq_peer_summary$ub <- GUI_no_diag_sdq_peer_summary$peer_mean + 1.96*GUI_no_diag_sdq_peer_summary$se
GUI_no_diag_sdq_peer_summary
```



```{r}
ireland_age_break <- c("9","13","17/18")
ireland_sdq_peer_mean_full <- full_join(full_join(GUI_autism_peer_early_summary, GUI_autism_peer_late_summary), GUI_no_diag_sdq_peer_summary)

p <- ggplot(ireland_sdq_peer_mean_full, aes(x = as.numeric(sweep), y = peer_mean, colour = group)) + geom_line(data = ireland_sdq_peer_mean_full, aes(x = as.numeric(sweep), y = peer_mean, colour = group)) + geom_point() 

p
breaks = seq(min(as.numeric(GUI_autism_peer_early_summary$sweep)),max(as.numeric(GUI_autism_peer_early_summary$sweep)), length.out = 3)

ireland_full_peer_in_display <- p+geom_ribbon(data = ireland_sdq_peer_mean_full, aes(x = as.numeric(sweep),ymin = lb, ymax = ub), linetype = 2, alpha = 0.2) + scale_x_continuous(breaks = breaks ,labels= ireland_age_break) + labs(y = "GUI SDQ Peer Relationship Problems Score", x = "Age (years)") + theme_classic() + scale_colour_manual(values = my_colors)+ theme(legend.position = "none")
ireland_full_peer_in_display

```


# Prosocial

```{r}

GUI_autism_pro_early <- GUI_SDQ_autism_early[,c(1:2,10,16,22)]
colnames(GUI_autism_pro_early)[3:5] = c("w1","w2","w3")
GUI_autism_pro_early_long <- melt(setDT(GUI_autism_pro_early), id.vars = c("Idnumber","sex"), variable.name = "sweep")


GUI_autism_pro_early_mean <- 
 GUI_autism_pro_early_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)
GUI_autism_pro_early_long$group <- "early"
```

```{r}
age <- c("9","13","17/18")
CC_autism_b9_indi_gt <- GUI_autism_pro_early_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_autism_b9_indi_gt
  
CC_autism_b9_mean_gt <-ggplot(data=GUI_autism_pro_early_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_autism_b9_mean_gt

CC_autism_b9_indi_mean_gt <- GUI_autism_pro_early_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_autism_pro_early_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_autism_b9_indi_mean_gt + scale_x_discrete(labels= age) + labs(y = "SDQ Prosocial Score", x = "age(years)")

```
```{r}

GUI_autism_pro_late <- GUI_SDQ_autism_late[,c(1:2,10,16,22)]
colnames(GUI_autism_pro_late)[3:5] = c("w1","w2","w3")
GUI_autism_pro_late_long <- melt(setDT(GUI_autism_pro_late), id.vars = c("Idnumber","sex"), variable.name = "sweep")


GUI_autism_pro_late_mean <- 
 GUI_autism_pro_late_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)
GUI_autism_pro_late_long$group <- "late"
```

```{r}

CC_autism_a9_indi_gt <- GUI_autism_pro_late_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_autism_a9_indi_gt
  
CC_autism_a9_mean_gt <-ggplot(data=GUI_autism_pro_late_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_autism_a9_mean_gt

CC_autism_a9_indi_mean_gt <- GUI_autism_pro_late_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_autism_pro_late_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_autism_a9_indi_mean_gt+ scale_x_discrete(labels= age) + labs(y = "SDQ Prosocial Score", x = "age(years)")

```
```{r}

GUI_no_diag_sdq_pro <- GUI_SDQ_no_diag[,c(1:2,10,16,22)]
colnames(GUI_no_diag_sdq_pro)[3:5] = c("w1","w2","w3")
GUI_no_diag_sdq_pro_long <- melt(setDT(GUI_no_diag_sdq_pro), id.vars = c("Idnumber","sex"), variable.name = "sweep")


GUI_no_diag_sdq_pro_mean <- 
 GUI_no_diag_sdq_pro_long  %>% 
  group_by(sweep) %>%
  summarise_at(vars(value), list(value = mean)) %>% as.data.frame(.)

GUI_no_diag_sdq_pro_long$group <- "no_diag"
```

```{r}

CC_no_diag_indi_gt <- GUI_no_diag_sdq_pro_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")
CC_no_diag_indi_gt
  
CC_no_diag_mean_gt <-ggplot(data=GUI_no_diag_sdq_pro_mean, aes(x=sweep, y=value, group=1)) +
  geom_line(color="red")+
  geom_point()

CC_no_diag_mean_gt

CC_no_diag_indi_mean_gt <- GUI_no_diag_sdq_pro_long %>%
  ggplot(aes(x=sweep, value)) + geom_line(aes(group=Idnumber), colour = "grey")+
  geom_line(data = GUI_no_diag_sdq_pro_mean, aes(x = sweep , y = value, group = 1), colour = "red")
CC_no_diag_indi_mean_gt+ scale_x_discrete(labels= age) + labs(y = "SDQ Prosocial Score", x = "age(years)") 

```

```{r}

GUI_autism_pro_late_summary <- GUI_autism_pro_late_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    pro_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_autism_pro_late_summary$group <- "late"
GUI_autism_pro_late_summary$lb <- GUI_autism_pro_late_summary$pro_mean - 1.96*GUI_autism_pro_late_summary$se
GUI_autism_pro_late_summary$ub <- GUI_autism_pro_late_summary$pro_mean + 1.96*GUI_autism_pro_late_summary$se
GUI_autism_pro_late_summary


GUI_autism_pro_early_summary <- GUI_autism_pro_early_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    pro_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_autism_pro_early_summary$group <- "early"
GUI_autism_pro_early_summary$lb <- GUI_autism_pro_early_summary$pro_mean - 1.96*GUI_autism_pro_early_summary$se
GUI_autism_pro_early_summary$ub <- GUI_autism_pro_early_summary$pro_mean + 1.96*GUI_autism_pro_early_summary$se
GUI_autism_pro_early_summary


GUI_no_diag_sdq_pro_summary <- GUI_no_diag_sdq_pro_long  %>%
  group_by(sweep,group) %>%
  summarise(
    sd = sd(value),
    pro_mean = mean(value),
    se = plotrix::std.error(value)
  )

GUI_no_diag_sdq_pro_summary$group <- "no_diag"
GUI_no_diag_sdq_pro_summary$lb <- GUI_no_diag_sdq_pro_summary$pro_mean - 1.96*GUI_no_diag_sdq_pro_summary$se
GUI_no_diag_sdq_pro_summary$ub <- GUI_no_diag_sdq_pro_summary$pro_mean + 1.96*GUI_no_diag_sdq_pro_summary$se
GUI_no_diag_sdq_pro_summary
```



```{r}
ireland_age_break <- c("9","13","17/18")
ireland_sdq_pro_mean_full <- full_join(full_join(GUI_autism_pro_early_summary, GUI_autism_pro_late_summary), GUI_no_diag_sdq_pro_summary)

p <- ggplot(ireland_sdq_pro_mean_full, aes(x = as.numeric(sweep), y = pro_mean, colour = group)) + geom_line(data = ireland_sdq_pro_mean_full, aes(x = as.numeric(sweep), y = pro_mean, colour = group)) + geom_point() 

p

ireland_full_pro_in_display <- p+geom_ribbon(data = ireland_sdq_pro_mean_full, aes(x = as.numeric(sweep),ymin = lb, ymax = ub), linetype = 2, alpha = 0.2) + scale_x_continuous(breaks = breaks ,labels= ireland_age_break) + labs(y = "GUI SDQ Prosocial Behaviours Score", x = "Age (years)") + theme_classic() + scale_colour_manual(values = my_colors)+ theme(legend.position = "none")

ireland_full_pro_in_display
```

```{r}
pdf(file = "/Users/zhangxinhe/Documents/who recieves a diagnosis/Figures FINAL/GUI_traj.pdf",width = 10,height = 6)
ireland_full_ttl_in_display
ireland_full_emo_in_display
ireland_full_con_in_display
ireland_full_hyp_in_display
ireland_full_peer_in_display
ireland_full_pro_in_display
dev.off()


```

# LGCM
# SDQ Total
```{r}
# Simple models
GUI_lgm_ttl <- "
i =~ 1*w1_total + 1*w2_total + 1*w3_total
s =~ 0*w1_total + 1*w2_total + 2*w3_total
w1_total ~~ 1*w1_total"

GUI_lgm_ttl_fit_early <- growth(GUI_lgm_ttl, 
                           data = GUI_SDQ_autism_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_ttl_fit_early)


GUI_lgm_ttl_fit_late <- growth(GUI_lgm_ttl, 
                           data = GUI_SDQ_autism_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_ttl_fit_late)


GUI_lgm_ttl_fit_no_diag <- growth(GUI_lgm_ttl, 
                           data = GUI_SDQ_no_diag,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_ttl_fit_no_diag)
```

```{r}
est_gui_lgm_ttl_early <- parameterEstimates(GUI_lgm_ttl_fit_early) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_ttl_early <- est_gui_lgm_ttl_early %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)



est_gui_lgm_ttl_late <- parameterEstimates(GUI_lgm_ttl_fit_late) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_ttl_late <- est_gui_lgm_ttl_late %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)



est_gui_lgm_ttl_no_diag <- parameterEstimates(GUI_lgm_ttl_fit_no_diag) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_ttl_no_diag <- est_gui_lgm_ttl_no_diag %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)

results_gui_lgm_ttl <- rbind(results_gui_lgm_ttl_early,results_gui_lgm_ttl_late,results_gui_lgm_ttl_no_diag)
results_gui_lgm_ttl
```




# Emo
```{r}
# Simple models
GUI_lgm_emo <- "
i =~ 1*w1_emo + 1*w2_emo + 1*w3_emo
s =~ 0*w1_emo + 1*w2_emo + 2*w3_emo
s ~~ 1*s
"

GUI_lgm_emo_fit_early <- growth(GUI_lgm_emo, 
                           data = GUI_SDQ_autism_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_emo_fit_early)


GUI_lgm_emo_fit_late <- growth(GUI_lgm_emo, 
                           data = GUI_SDQ_autism_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_emo_fit_late)


GUI_lgm_emo_fit_no_diag <- growth(GUI_lgm_emo, 
                           data = GUI_SDQ_no_diag,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_emo_fit_no_diag)
```

```{r}
est_gui_lgm_emo_early <- parameterEstimates(GUI_lgm_emo_fit_early) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_emo_early <- est_gui_lgm_emo_early %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)



est_gui_lgm_emo_late <- parameterEstimates(GUI_lgm_emo_fit_late) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_emo_late <- est_gui_lgm_emo_late %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)



est_gui_lgm_emo_no_diag <- parameterEstimates(GUI_lgm_emo_fit_no_diag) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_emo_no_diag <- est_gui_lgm_emo_no_diag %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)

results_gui_lgm_emo <- rbind(results_gui_lgm_emo_early,results_gui_lgm_emo_late,results_gui_lgm_emo_no_diag)
results_gui_lgm_emo
```

# Con
```{r}
# Simple models
GUI_lgm_con <- "
i =~ 1*w1_con + 1*w2_con + 1*w3_con
s =~ 0*w1_con + 1*w2_con + 2*w3_con
w1_con ~~ 1*w1_con
w3_con ~~ 1*w3_con

s ~~1*s
"

GUI_lgm_con_fit_early <- growth(GUI_lgm_con, 
                           data = GUI_SDQ_autism_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_con_fit_early)


GUI_lgm_con_fit_late <- growth(GUI_lgm_con, 
                           data = GUI_SDQ_autism_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_con_fit_late)


GUI_lgm_con_fit_no_diag <- growth(GUI_lgm_con, 
                           data = GUI_SDQ_no_diag,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_con_fit_no_diag)
```

```{r}
est_gui_lgm_con_early <- parameterEstimates(GUI_lgm_con_fit_early) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_con_early <- est_gui_lgm_con_early %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)



est_gui_lgm_con_late <- parameterEstimates(GUI_lgm_con_fit_late) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_con_late <- est_gui_lgm_con_late %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)



est_gui_lgm_con_no_diag <- parameterEstimates(GUI_lgm_con_fit_no_diag) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_con_no_diag <- est_gui_lgm_con_no_diag %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)

results_gui_lgm_con <- rbind(results_gui_lgm_con_early,results_gui_lgm_con_late,results_gui_lgm_con_no_diag)
results_gui_lgm_con
```
# Hyp

```{r}
# Simple models
GUI_lgm_hyp <- "
i =~ 1*w1_hyp + 1*w2_hyp + 1*w3_hyp
s =~ 0*w1_hyp + 1*w2_hyp + 2*w3_hyp
w1_hyp ~~ 1*w1_hyp"

GUI_lgm_hyp_fit_early <- growth(GUI_lgm_hyp, 
                           data = GUI_SDQ_autism_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_hyp_fit_early)


GUI_lgm_hyp_fit_late <- growth(GUI_lgm_hyp, 
                           data = GUI_SDQ_autism_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_hyp_fit_late)


GUI_lgm_hyp_fit_no_diag <- growth(GUI_lgm_hyp, 
                           data = GUI_SDQ_no_diag,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_hyp_fit_no_diag)
```
```{r}
est_gui_lgm_hyp_early <- parameterEstimates(GUI_lgm_hyp_fit_early) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_hyp_early <- est_gui_lgm_hyp_early %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)



est_gui_lgm_hyp_late <- parameterEstimates(GUI_lgm_hyp_fit_late) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_hyp_late <- est_gui_lgm_hyp_late %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
 mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)


est_gui_lgm_hyp_no_diag <- parameterEstimates(GUI_lgm_hyp_fit_no_diag) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_hyp_no_diag <- est_gui_lgm_hyp_no_diag %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

results_gui_lgm_hyp <- rbind(results_gui_lgm_hyp_early,results_gui_lgm_hyp_late,results_gui_lgm_hyp_no_diag)
results_gui_lgm_hyp
```
# Peer

```{r}
# Simple models
GUI_lgm_peer <- "
i =~ 1*w1_peer + 1*w2_peer + 1*w3_peer
s =~ 0*w1_peer + 1*w2_peer + 2*w3_peer
w1_peer ~~ 1*w1_peer"

GUI_lgm_peer_fit_early <- growth(GUI_lgm_peer, 
                           data = GUI_SDQ_autism_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_peer_fit_early)


GUI_lgm_peer_fit_late <- growth(GUI_lgm_peer, 
                           data = GUI_SDQ_autism_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_peer_fit_late)


GUI_lgm_peer_fit_no_diag <- growth(GUI_lgm_peer, 
                           data = GUI_SDQ_no_diag,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_peer_fit_no_diag)
```

```{r}
est_gui_lgm_peer_early <- parameterEstimates(GUI_lgm_peer_fit_early) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_peer_early <- est_gui_lgm_peer_early %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)



est_gui_lgm_peer_late <- parameterEstimates(GUI_lgm_peer_fit_late) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_peer_late <- est_gui_lgm_peer_late %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
 mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

est_gui_lgm_peer_no_diag <- parameterEstimates(GUI_lgm_peer_fit_no_diag) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_peer_no_diag <- est_gui_lgm_peer_no_diag %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
 mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

results_gui_lgm_peer <- rbind(results_gui_lgm_peer_early,results_gui_lgm_peer_late,results_gui_lgm_peer_no_diag)
results_gui_lgm_peer
```
# Prosocial

```{r}
# Simple models
GUI_lgm_pro <- "
i =~ 1*w1_pro + 1*w2_pro + 1*w3_pro
s =~ 0*w1_pro + 1*w2_pro + 2*w3_pro
"

GUI_lgm_pro_fit_early <- growth(GUI_lgm_pro, 
                           data = GUI_SDQ_autism_early,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_pro_fit_early)


GUI_lgm_pro_fit_late <- growth(GUI_lgm_pro, 
                           data = GUI_SDQ_autism_late,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_pro_fit_late)


GUI_lgm_pro_fit_no_diag <- growth(GUI_lgm_pro, 
                           data = GUI_SDQ_no_diag,
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_pro_fit_no_diag)
```

```{r}
est_gui_lgm_pro_early <- parameterEstimates(GUI_lgm_pro_fit_early) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_pro_early <- est_gui_lgm_pro_early %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
 mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)



est_gui_lgm_pro_late <- parameterEstimates(GUI_lgm_pro_fit_late) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_pro_late <- est_gui_lgm_pro_late %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)


est_gui_lgm_pro_no_diag <- parameterEstimates(GUI_lgm_pro_fit_no_diag) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_pro_no_diag <- est_gui_lgm_pro_no_diag %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
 mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,Estimates, p_value)

results_gui_lgm_pro <- rbind(results_gui_lgm_pro_early,results_gui_lgm_pro_late,results_gui_lgm_pro_no_diag)
results_gui_lgm_pro
```

# Lgcm str. diag.age regressed w/ sex
```{r}

GUI_lgm_ttl_sex <- "
i =~ 1*w1_total + 1*w2_total + 1*w3_total
s =~ 0*w1_total + 1*w2_total + 2*w3_total
w1_total ~~ 1*w1_total
i ~ sex
s ~ sex
sex ~~ sex
"

gui_lgm_ttl_sex_fit <- lavaan::growth(GUI_lgm_ttl_sex, data = GUI_SDQ_all, group = "group", 
                                      missing = "fiml", estimator = "ml", fixed.x = F)
summary_sex_ttl <- summary(gui_lgm_ttl_sex_fit)
est_gui_lgm_ttl_sex <- parameterEstimates(gui_lgm_ttl_sex_fit) %>% filter(lhs %in% c("i","s") & op == "~1")
results_est_gui_lgm_ttl_sex <- est_gui_lgm_ttl_sex %>% dplyr::select(lhs, group, est, ci.lower, ci.upper, pvalue) %>% mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,group,Estimates, p_value)
results_est_gui_lgm_ttl_sex
```


```{r}

GUI_lgm_emo_sex <- "
i =~ 1*w1_emo + 1*w2_emo + 1*w3_emo
s =~ 0*w1_emo + 1*w2_emo + 2*w3_emo
s ~~ 1*s
i ~ sex
s ~ sex
sex ~~ sex
"

gui_lgm_emo_sex_fit <- lavaan::growth(GUI_lgm_emo_sex, data = GUI_SDQ_all, group = "group", 
                                      missing = "fiml", estimator = "ml", fixed.x = F)
summary_sex_emo <- summary(gui_lgm_emo_sex_fit)
summary_sex_emo
est_gui_lgm_emo_sex <- parameterEstimates(gui_lgm_emo_sex_fit) %>% filter(lhs %in% c("i","s") & op == "~1")
results_est_gui_lgm_emo_sex <- est_gui_lgm_emo_sex %>% dplyr::select(lhs, group, est, ci.lower, ci.upper, pvalue) %>% mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,group,Estimates, p_value)
results_est_gui_lgm_emo_sex
```
```{r}

GUI_lgm_con_sex <- "
i =~ 1*w1_con + 1*w2_con + 1*w3_con
s =~ 0*w1_con + 1*w2_con + 2*w3_con
s ~~ 1*s
w1_con ~~ 1*w1_con
w3_con ~~ 1*w3_con
i ~ sex
s ~ sex
sex ~~ sex
"

gui_lgm_con_sex_fit <- lavaan::growth(GUI_lgm_con_sex, data = GUI_SDQ_all, group = "group", 
                                      missing = "fiml", estimator = "ml", fixed.x = F)
summary_sex_con <- summary(gui_lgm_con_sex_fit)
summary_sex_con
est_gui_lgm_con_sex <- parameterEstimates(gui_lgm_con_sex_fit) %>% filter(lhs %in% c("i","s") & op == "~1")
results_est_gui_lgm_con_sex <- est_gui_lgm_con_sex %>% dplyr::select(lhs, group, est, ci.lower, ci.upper, pvalue) %>% mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,group,Estimates, p_value)
results_est_gui_lgm_con_sex
```
```{r}

GUI_lgm_hyp_sex <- "
i =~ 1*w1_hyp + 1*w2_hyp + 1*w3_hyp
s =~ 0*w1_hyp + 1*w2_hyp + 2*w3_hyp
w1_hyp ~~ 1*w1_hyp
i ~ sex
s ~ sex
sex ~~ sex
"

gui_lgm_hyp_sex_fit <- lavaan::growth(GUI_lgm_hyp_sex, data = GUI_SDQ_all, group = "group", 
                                      missing = "fiml", estimator = "ml", fixed.x = F)
summary_sex_hyp <- summary(gui_lgm_hyp_sex_fit)
summary_sex_hyp
est_gui_lgm_hyp_sex <- parameterEstimates(gui_lgm_hyp_sex_fit) %>% filter(lhs %in% c("i","s") & op == "~1")
results_est_gui_lgm_hyp_sex <- est_gui_lgm_hyp_sex %>% dplyr::select(lhs, group, est, ci.lower, ci.upper, pvalue) %>% mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,group,Estimates, p_value)
results_est_gui_lgm_hyp_sex
```
```{r}

GUI_lgm_peer_sex <- "
i =~ 1*w1_peer + 1*w2_peer + 1*w3_peer
s =~ 0*w1_peer + 1*w2_peer + 2*w3_peer
w1_peer ~~ 1*w1_peer
i ~ sex
s ~ sex
sex ~~ sex
"

gui_lgm_peer_sex_fit <- lavaan::growth(GUI_lgm_peer_sex, data = GUI_SDQ_all, group = "group", 
                                      missing = "fiml", estimator = "ml", fixed.x = F)
summary_sex_peer <- summary(gui_lgm_peer_sex_fit)
summary_sex_peer
est_gui_lgm_peer_sex <- parameterEstimates(gui_lgm_peer_sex_fit) %>% filter(lhs %in% c("i","s") & op == "~1")
results_est_gui_lgm_peer_sex <- est_gui_lgm_peer_sex %>% dplyr::select(lhs, group, est, ci.lower, ci.upper, pvalue) %>% mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,group,Estimates, p_value)
results_est_gui_lgm_peer_sex
```
```{r}

GUI_lgm_pro_sex <- "
i =~ 1*w1_pro + 1*w2_pro + 1*w3_pro
s =~ 0*w1_pro + 1*w2_pro + 2*w3_pro
w1_pro ~~ 1*w1_pro
i ~ sex
s ~ sex
sex ~~ sex
"

gui_lgm_pro_sex_fit <- lavaan::growth(GUI_lgm_pro_sex, data = GUI_SDQ_all, group = "group", 
                                      missing = "fiml", estimator = "ml", fixed.x = F)
summary_sex_pro <- summary(gui_lgm_pro_sex_fit)
est_gui_lgm_pro_sex <- parameterEstimates(gui_lgm_pro_sex_fit) %>% filter(lhs %in% c("i","s") & op == "~1")
results_est_gui_lgm_pro_sex <- est_gui_lgm_pro_sex %>% dplyr::select(lhs, group, est, ci.lower, ci.upper, pvalue) %>% mutate(Estimates = sprintf("%.2f [%0.2f, %0.2f]", est, ci.lower, ci.upper),
         p_value = sprintf("%.3f", pvalue)) %>%
  dplyr::select(lhs,group,Estimates, p_value)
results_est_gui_lgm_pro_sex
```

# LGCM by sex
## Total
```{r}
# Simple models
GUI_lgm_ttl <- "
i =~ 1*w1_total + 1*w2_total + 1*w3_total
s =~ 0*w1_total + 1*w2_total + 2*w3_total
w3_total ~~ 1*w3_total"

gui_sexstr_ttl_fit <- growth(GUI_lgm_ttl, 
                           data = GUI_SDQ_autism, group = "sex",
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

#summary(GUI_lgm_ttl_fit_sexstr)
gui_asd_ttl_fit <- growth(GUI_lgm_ttl, data = GUI_SDQ_autism, missing = "fiml",
                            estimator = "ml", fixed.x = F)
gui_agestr_ttl_fit <- growth(GUI_lgm_ttl, data = GUI_SDQ_autism,
                               group = "group",missing = "fiml",
                            estimator = "ml", fixed.x = F)

gui_ttl_anova_sex <- anova(gui_asd_ttl_fit,gui_sexstr_ttl_fit)
gui_ttl_anova_age <- anova(gui_asd_ttl_fit,gui_agestr_ttl_fit)
gui_anova_ttl_age_results<- data.frame(gui_ttl_anova_age)
gui_anova_ttl_sex_results<- data.frame(gui_ttl_anova_sex)
gui_anova_ttl <- rbind(gui_anova_ttl_age_results,gui_anova_ttl_sex_results)
gui_anova_ttl



```

```{r}
est_gui_lgm_ttl_sexstr <- parameterEstimates(GUI_lgm_ttl_fit_sexstr) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_ttl_sexstr <- est_gui_lgm_ttl_sexstr %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_gui_lgm_ttl_sexstr

```

## Emotonal
```{r}
# Simple models
GUI_lgm_emo <- "
i =~ 1*w1_emo + 1*w2_emo + 1*w3_emo
s =~ 0*w1_emo + 1*w2_emo + 2*w3_emo
s ~~ 1*s"

gui_sexstr_emo_fit <- growth(GUI_lgm_emo, 
                           data = GUI_SDQ_autism, group = "sex",
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

#summary(GUI_lgm_emo_fit_sexstr)
gui_asd_emo_fit <- growth(GUI_lgm_emo, data = GUI_SDQ_autism, missing = "fiml",
                            estimator = "ml", fixed.x = F)
gui_agestr_emo_fit <- growth(GUI_lgm_emo, data = GUI_SDQ_autism,
                               group = "group",missing = "fiml",
                            estimator = "ml", fixed.x = F)

gui_emo_anova_sex <- anova(gui_asd_emo_fit,gui_sexstr_emo_fit)
gui_emo_anova_age <- anova(gui_asd_emo_fit,gui_agestr_emo_fit)
gui_anova_emo_age_results<- data.frame(gui_emo_anova_age)
gui_anova_emo_sex_results<- data.frame(gui_emo_anova_sex)
gui_anova_emo <- rbind(gui_anova_emo_age_results,gui_anova_emo_sex_results)
gui_anova_emo



```

```{r}
est_gui_lgm_emo_sexstr <- parameterEstimates(GUI_lgm_emo_fit_sexstr) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_emo_sexstr <- est_gui_lgm_emo_sexstr %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_gui_lgm_emo_sexstr

```

## Conduct problems
```{r}
# Simple models
GUI_lgm_con <- "
i =~ 1*w1_con + 1*w2_con + 1*w3_con
s =~ 0*w1_con + 1*w2_con + 2*w3_con
"

gui_sexstr_con_fit <- growth(GUI_lgm_con, 
                           data = GUI_SDQ_autism, group = "sex",
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

#summary(GUI_lgm_con_fit_sexstr)
gui_asd_con_fit <- growth(GUI_lgm_con, data = GUI_SDQ_autism, missing = "fiml",
                            estimator = "ml", fixed.x = F)
gui_agestr_con_fit <- growth(GUI_lgm_con, data = GUI_SDQ_autism,
                               group = "group",missing = "fiml",
                            estimator = "ml", fixed.x = F)

gui_con_anova_sex <- anova(gui_asd_con_fit,gui_sexstr_con_fit)
gui_con_anova_age <- anova(gui_asd_con_fit,gui_agestr_con_fit)
gui_anova_con_age_results<- data.frame(gui_con_anova_age)
gui_anova_con_sex_results<- data.frame(gui_con_anova_sex)
gui_anova_con <- rbind(gui_anova_con_age_results,gui_anova_con_sex_results)
gui_anova_con


```

```{r}
est_gui_lgm_con_sexstr <- parameterEstimates(GUI_lgm_con_fit_sexstr) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_con_sexstr <- est_gui_lgm_con_sexstr %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_gui_lgm_con_sexstr

```


## Hyperactivity
```{r}
# Simple models
GUI_lgm_hyp <- "
i =~ 1*w1_hyp + 1*w2_hyp + 1*w3_hyp
s =~ 0*w1_hyp + 1*w2_hyp + 2*w3_hyp
w1_hyp ~~ 1*w1_hyp"

gui_sexstr_hyp_fit <- growth(GUI_lgm_hyp, 
                           data = GUI_SDQ_autism, group = "sex",
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

#summary(GUI_lgm_hyp_fit_sexstr)
gui_asd_hyp_fit <- growth(GUI_lgm_hyp, data = GUI_SDQ_autism, missing = "fiml",
                            estimator = "ml", fixed.x = F)
gui_agestr_hyp_fit <- growth(GUI_lgm_hyp, data = GUI_SDQ_autism,
                               group = "group",missing = "fiml",
                            estimator = "ml", fixed.x = F)

gui_hyp_anova_sex <- anova(gui_asd_hyp_fit,gui_sexstr_hyp_fit)
gui_hyp_anova_age <- anova(gui_asd_hyp_fit,gui_agestr_hyp_fit)
gui_anova_hyp_age_results<- data.frame(gui_hyp_anova_age)
gui_anova_hyp_sex_results<- data.frame(gui_hyp_anova_sex)
gui_anova_hyp <- rbind(gui_anova_hyp_age_results,gui_anova_hyp_sex_results)
gui_anova_hyp





```

```{r}
est_gui_lgm_hyp_sexstr <- parameterEstimates(GUI_lgm_hyp_fit_sexstr) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_hyp_sexstr <- est_gui_lgm_hyp_sexstr %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_gui_lgm_hyp_sexstr

```


## Peer problems
```{r}
# Simple models
GUI_lgm_peer <- "
i =~ 1*w1_peer + 1*w2_peer + 1*w3_peer
s =~ 0*w1_peer + 1*w2_peer + 2*w3_peer
w3_peer ~~ 1*w3_peer"

gui_sexstr_peer_fit <- growth(GUI_lgm_peer, 
                           data = GUI_SDQ_autism, group = "sex",
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

#summary(GUI_lgm_peer_fit_sexstr)
gui_asd_peer_fit <- growth(GUI_lgm_peer, data = GUI_SDQ_autism, missing = "fiml",
                            estimator = "ml", fixed.x = F)
gui_agestr_peer_fit <- growth(GUI_lgm_peer, data = GUI_SDQ_autism,
                               group = "group",missing = "fiml",
                            estimator = "ml", fixed.x = F)

gui_peer_anova_sex <- anova(gui_asd_peer_fit,gui_sexstr_peer_fit)
gui_peer_anova_age <- anova(gui_asd_peer_fit,gui_agestr_peer_fit)
gui_anova_peer_age_results<- data.frame(gui_peer_anova_age)
gui_anova_peer_sex_results<- data.frame(gui_peer_anova_sex)
gui_anova_peer <- rbind(gui_anova_peer_age_results,gui_anova_peer_sex_results)
gui_anova_peer




```

```{r}
est_gui_lgm_peer_sexstr <- parameterEstimates(GUI_lgm_peer_fit_sexstr) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_peer_sexstr <- est_gui_lgm_peer_sexstr %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_gui_lgm_peer_sexstr

```


## Prosocial
```{r}
# Simple models
GUI_lgm_pro <- "
i =~ 1*w1_pro + 1*w2_pro + 1*w3_pro
s =~ 0*w1_pro + 1*w2_pro + 2*w3_pro
"

gui_sexstr_pro_fit <- growth(GUI_lgm_pro, 
                           data = GUI_SDQ_autism, group = "sex",
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

#summary(GUI_lgm_pro_fit_sexstr)
gui_asd_pro_fit <- growth(GUI_lgm_pro, data = GUI_SDQ_autism, missing = "fiml",
                            estimator = "ml", fixed.x = F)
gui_agestr_pro_fit <- growth(GUI_lgm_pro, data = GUI_SDQ_autism,
                               group = "group",missing = "fiml",
                            estimator = "ml", fixed.x = F)

gui_pro_anova_sex <- anova(gui_asd_pro_fit,gui_sexstr_pro_fit)
gui_pro_anova_age <- anova(gui_asd_pro_fit,gui_agestr_pro_fit)
gui_anova_pro_age_results<- data.frame(gui_pro_anova_age)
gui_anova_pro_sex_results<- data.frame(gui_pro_anova_sex)
gui_anova_pro <- rbind(gui_anova_pro_age_results,gui_anova_pro_sex_results)
gui_anova_pro





```

```{r}
est_gui_lgm_pro_sexstr <- parameterEstimates(GUI_lgm_pro_fit_sexstr) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_pro_sexstr <- est_gui_lgm_pro_sexstr %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_gui_lgm_pro_sexstr

```





# LGCM by sex regressed with diag.age
## Total
```{r}
# Simple models
GUI_lgm_ttl_age <- "
i =~ 1*w1_total + 1*w2_total + 1*w3_total
s =~ 0*w1_total + 1*w2_total + 2*w3_total
w1_total ~~ 1*w1_total
w3_total ~~ 1*w3_total
i ~ group
s ~ group
group ~~ group"

GUI_lgm_ttl_fit_sexstr_age <- growth(GUI_lgm_ttl_age, 
                           data = GUI_SDQ_autism, group = "sex",
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_ttl_fit_sexstr_age)



```

```{r}
est_gui_lgm_ttl_sexstr_age <- parameterEstimates(GUI_lgm_ttl_fit_sexstr_age) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_ttl_sexstr_age <- est_gui_lgm_ttl_sexstr_age %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_gui_lgm_ttl_sexstr_age

```

## Emotonal
```{r}
# Simple models
GUI_lgm_emo_age<- "
i =~ 1*w1_emo + 1*w2_emo + 1*w3_emo
s =~ 0*w1_emo + 1*w2_emo + 2*w3_emo
s ~~ 1*s
i ~ group
s ~ group
group ~~ group"

GUI_lgm_emo_fit_sexstr_age <- growth(GUI_lgm_emo_age, 
                           data = GUI_SDQ_autism, group = "sex",
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_emo_fit_sexstr_age)



```

```{r}
est_gui_lgm_emo_sexstr_age <- parameterEstimates(GUI_lgm_emo_fit_sexstr_age) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_emo_sexstr_age <- est_gui_lgm_emo_sexstr_age %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_gui_lgm_emo_sexstr_age

```

## Conduct problems
```{r}
# Simple models
GUI_lgm_con_age <- "
i =~ 1*w1_con + 1*w2_con + 1*w3_con
s =~ 0*w1_con + 1*w2_con + 2*w3_con
i ~ group
s ~ group
group ~~ group
"

GUI_lgm_con_fit_sexstr_age <- growth(GUI_lgm_con_age, 
                           data = GUI_SDQ_autism, group = "sex",
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_con_fit_sexstr_age)



```

```{r}
est_gui_lgm_con_sexstr_age <- parameterEstimates(GUI_lgm_con_fit_sexstr_age) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_con_sexstr_age <- est_gui_lgm_con_sexstr_age %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_gui_lgm_con_sexstr_age

```


## Hyperactivity
```{r}
# Simple models
GUI_lgm_hyp_age <- "
i =~ 1*w1_hyp + 1*w2_hyp + 1*w3_hyp
s =~ 0*w1_hyp + 1*w2_hyp + 2*w3_hyp
w1_hyp ~~ 1*w1_hyp
i ~ group
s ~ group
group ~~ group"

GUI_lgm_hyp_fit_sexstr_age <- growth(GUI_lgm_hyp_age, 
                           data = GUI_SDQ_autism, group = "sex",
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_hyp_fit_sexstr_age)



```

```{r}
est_gui_lgm_hyp_sexstr_age <- parameterEstimates(GUI_lgm_hyp_fit_sexstr_age) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_hyp_sexstr_age <- est_gui_lgm_hyp_sexstr_age %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_gui_lgm_hyp_sexstr_age

```


## Peer problems
```{r}
# Simple models
GUI_lgm_peer_age <- "
i =~ 1*w1_peer + 1*w2_peer + 1*w3_peer
s =~ 0*w1_peer + 1*w2_peer + 2*w3_peer
w3_peer ~~ 1*w3_peer
i ~ group
s ~ group
group ~~ group"

GUI_lgm_peer_fit_sexstr_age <- growth(GUI_lgm_peer_age, 
                           data = GUI_SDQ_autism, group = "sex",
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_peer_fit_sexstr_age)



```

```{r}
est_gui_lgm_peer_sexstr_age <- parameterEstimates(GUI_lgm_peer_fit_sexstr_age) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_peer_sexstr_age <- est_gui_lgm_peer_sexstr_age %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_gui_lgm_peer_sexstr_age

```


## Prosocial
```{r}
# Simple models
GUI_lgm_pro_age <- "
i =~ 1*w1_pro + 1*w2_pro + 1*w3_pro
s =~ 0*w1_pro + 1*w2_pro + 2*w3_pro
i ~~ 1*i
s ~~ 1*s
w3_pro ~~ 1*w3_pro
i ~ group
s ~ group
group ~~ group
"

GUI_lgm_pro_fit_sexstr_age <- growth(GUI_lgm_pro_age, 
                           data = GUI_SDQ_autism, group = "sex",
                           missing = "fiml",
                           estimator = "ml", fixed.x = FALSE
                )

summary(GUI_lgm_pro_fit_sexstr_age)



```

```{r}
est_gui_lgm_pro_sexstr_age <- parameterEstimates(GUI_lgm_pro_fit_sexstr_age) %>% filter(grepl("i|s", lhs) & op == "~1")
results_gui_lgm_pro_sexstr_age <- est_gui_lgm_pro_sexstr_age %>%
  dplyr::select(lhs, est, ci.lower, ci.upper, pvalue) %>%
  mutate(Estimates = paste(round(est, 2), " [", round(ci.lower, 2), ", ", round(ci.upper, 2), "]"),
         p_value = round(pvalue,3)) %>%
  dplyr::select(lhs,Estimates, p_value)
results_gui_lgm_pro_sexstr_age

```



## GMM
# SDQ total Create Long data for GMM (on diagnosed autistics children)
## Total GMM data prep
```{r}
GUI_SDQ_autism <- dplyr::mutate(GUI_SDQ_autism, numericID = row_number())
GUI_autism_wide_sdq_total <- GUI_SDQ_autism[,c("numericID","Idnumber","sex","diag.age","w1_total","w2_total","w3_total")] %>% na.omit
GUI_autism_long_sdq_total <- melt(setDT(GUI_autism_wide_sdq_total), id.vars = c("numericID","Idnumber","sex","diag.age"), variable.name = "sweep")

GUI_autism_long_sdq_total <- GUI_autism_long_sdq_total %>%
  mutate(Sweep = case_when(
    sweep == "w1_total" ~ 1,
    sweep == "w2_total" ~ 2,
    sweep == "w3_total" ~ 3
    )
    )

GUI_autism_wide_sdq_emo <- GUI_SDQ_autism[,c("numericID","Idnumber","sex","diag.age","w1_emo","w2_emo","w3_emo")] %>% na.omit
GUI_autism_long_sdq_emo <- melt(setDT(GUI_autism_wide_sdq_emo), id.vars = c("numericID","Idnumber","sex","diag.age"), variable.name = "sweep")

GUI_autism_long_sdq_emo <- GUI_autism_long_sdq_emo %>%
  mutate(Sweep = case_when(
    sweep == "w1_emo" ~ 1,
    sweep == "w2_emo" ~ 2,
    sweep == "w3_emo" ~ 3
    )
    )

GUI_autism_wide_sdq_con <- GUI_SDQ_autism[,c("numericID","Idnumber","sex","diag.age","w1_con","w2_con","w3_con")] %>% na.omit
GUI_autism_long_sdq_con <- melt(setDT(GUI_autism_wide_sdq_con), id.vars = c("numericID","Idnumber","sex","diag.age"), variable.name = "sweep")

GUI_autism_long_sdq_con <- GUI_autism_long_sdq_con %>%
  mutate(Sweep = case_when(
    sweep == "w1_con" ~ 1,
    sweep == "w2_con" ~ 2,
    sweep == "w3_con" ~ 3
    )
    )

GUI_autism_wide_sdq_hyp <- GUI_SDQ_autism[,c("numericID","Idnumber","sex","diag.age","w1_hyp","w2_hyp","w3_hyp")] %>% na.omit
GUI_autism_long_sdq_hyp <- melt(setDT(GUI_autism_wide_sdq_hyp), id.vars = c("numericID","Idnumber","sex","diag.age"), variable.name = "sweep")

GUI_autism_long_sdq_hyp <- GUI_autism_long_sdq_hyp %>%
  mutate(Sweep = case_when(
    sweep == "w1_hyp" ~ 1,
    sweep == "w2_hyp" ~ 2,
    sweep == "w3_hyp" ~ 3
    )
    )

GUI_autism_wide_sdq_peer <- GUI_SDQ_autism[,c("numericID","Idnumber","sex","diag.age","w1_peer","w2_peer","w3_peer")] %>% na.omit
GUI_autism_long_sdq_peer <- melt(setDT(GUI_autism_wide_sdq_peer), id.vars = c("numericID","Idnumber","sex","diag.age"), variable.name = "sweep")

GUI_autism_long_sdq_peer <- GUI_autism_long_sdq_peer %>%
  mutate(Sweep = case_when(
    sweep == "w1_peer" ~ 1,
    sweep == "w2_peer" ~ 2,
    sweep == "w3_peer" ~ 3
    )
    )

GUI_autism_wide_sdq_pro <- GUI_SDQ_autism[,c("numericID","Idnumber","sex","diag.age","w1_pro","w2_pro","w3_pro")] %>% na.omit
GUI_autism_long_sdq_pro <- melt(setDT(GUI_autism_wide_sdq_pro), id.vars = c("numericID","Idnumber","sex","diag.age"), variable.name = "sweep")

GUI_autism_long_sdq_pro <- GUI_autism_long_sdq_pro %>%
  mutate(Sweep = case_when(
    sweep == "w1_pro" ~ 1,
    sweep == "w2_pro" ~ 2,
    sweep == "w3_pro" ~ 3
    )
    )
```





# SDQ total GMM

```{r}
library(lcmm)
GUI_autism_ttl_gmm1 <- hlme(value ~ Sweep, subject = "numericID", random=~1, ng = 1, data =
GUI_autism_long_sdq_total)
summary(GUI_autism_ttl_gmm1)


GUI_autism_ttl_gmm2 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 2, data = GUI_autism_long_sdq_total, mixture = ~ Sweep,
nwg=T, B = GUI_autism_ttl_gmm1)
summary(GUI_autism_ttl_gmm2)


GUI_autism_ttl_gmm3 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 3, data = GUI_autism_long_sdq_total, mixture = ~ Sweep, 
nwg=T, B = GUI_autism_ttl_gmm1)
summary(GUI_autism_ttl_gmm3)

GUI_autism_ttl_gmm4 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 4, data = GUI_autism_long_sdq_total, mixture = ~ Sweep, 
nwg=T, B = GUI_autism_ttl_gmm1)
summary(GUI_autism_ttl_gmm4)

# make a table with results for the 4 models:
fit_ind_GUI_ttl <- summarytable(GUI_autism_ttl_gmm1, GUI_autism_ttl_gmm2, GUI_autism_ttl_gmm3, GUI_autism_ttl_gmm4,which = c("AIC","BIC","%class","entropy","npm","loglik","SABIC"))
```

## Emotional symptoms
```{r}

GUI_autism_emo_gmm1 <- hlme(value ~ Sweep, subject = "numericID", random=~1, ng = 1, data =
GUI_autism_long_sdq_emo)
summary(GUI_autism_emo_gmm1)


GUI_autism_emo_gmm2 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 2, data = GUI_autism_long_sdq_emo, mixture = ~ Sweep,
nwg=T, B = GUI_autism_emo_gmm1)
summary(GUI_autism_emo_gmm2)


GUI_autism_emo_gmm3 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 3, data = GUI_autism_long_sdq_emo, mixture = ~ Sweep, 
nwg=T, B = GUI_autism_emo_gmm1)
summary(GUI_autism_emo_gmm3)

GUI_autism_emo_gmm4 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 4, data = GUI_autism_long_sdq_emo, mixture = ~ Sweep, 
nwg=T, B = GUI_autism_emo_gmm1)
summary(GUI_autism_emo_gmm4)

# make a table with results for the 4 models:
fit_ind_GUI_emo <- summarytable(GUI_autism_emo_gmm1, GUI_autism_emo_gmm2, GUI_autism_emo_gmm3, GUI_autism_emo_gmm4,which = c("AIC","BIC","SABIC","%class","entropy","npm","loglik"))
```

## Conduct problems
```{r}

GUI_autism_con_gmm1 <- hlme(value ~ Sweep, subject = "numericID", random=~1, ng = 1, data =
GUI_autism_long_sdq_con)
summary(GUI_autism_con_gmm1)


GUI_autism_con_gmm2 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 2, data = GUI_autism_long_sdq_con, mixture = ~ Sweep,
nwg=T, B = GUI_autism_con_gmm1)
summary(GUI_autism_con_gmm2)


GUI_autism_con_gmm3 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 3, data = GUI_autism_long_sdq_con, mixture = ~ Sweep, 
nwg=T, B = GUI_autism_con_gmm1)
summary(GUI_autism_con_gmm3)

GUI_autism_con_gmm4 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 4, data = GUI_autism_long_sdq_con, mixture = ~ Sweep, 
nwg=T, B = GUI_autism_con_gmm1)
summary(GUI_autism_con_gmm4)

# make a table with results for the 4 models:
fit_ind_GUI_con <- summarytable(GUI_autism_con_gmm1, GUI_autism_con_gmm2, GUI_autism_con_gmm3, GUI_autism_con_gmm4,which = c("AIC","BIC","SABIC","%class","entropy","npm","loglik"))
```


## Hyperactivity/inattention
```{r}

GUI_autism_hyp_gmm1 <- hlme(value ~ Sweep, subject = "numericID", random=~1, ng = 1, data =
GUI_autism_long_sdq_hyp)
summary(GUI_autism_hyp_gmm1)


GUI_autism_hyp_gmm2 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 2, data = GUI_autism_long_sdq_hyp, mixture = ~ Sweep,
nwg=T, B = GUI_autism_hyp_gmm1)
summary(GUI_autism_hyp_gmm2)


GUI_autism_hyp_gmm3 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 3, data = GUI_autism_long_sdq_hyp, mixture = ~ Sweep, 
nwg=T, B = GUI_autism_hyp_gmm1)
summary(GUI_autism_hyp_gmm3)

GUI_autism_hyp_gmm4 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 4, data = GUI_autism_long_sdq_hyp, mixture = ~ Sweep, 
nwg=T, B = GUI_autism_hyp_gmm1)
summary(GUI_autism_hyp_gmm4)

# make a table with results for the 4 models:
fit_ind_GUI_hyp <- summarytable(GUI_autism_hyp_gmm1, GUI_autism_hyp_gmm2, GUI_autism_hyp_gmm3, GUI_autism_hyp_gmm4,which = c("AIC","BIC","SABIC","%class","entropy","npm","loglik"))
```


## Peer relationship problems
```{r}

GUI_autism_peer_gmm1 <- hlme(value ~ Sweep, subject = "numericID", random=~1, ng = 1, data =
GUI_autism_long_sdq_peer)
summary(GUI_autism_peer_gmm1)


GUI_autism_peer_gmm2 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 2, data = GUI_autism_long_sdq_peer, mixture = ~ Sweep,
nwg=T, B = GUI_autism_peer_gmm1)
summary(GUI_autism_peer_gmm2)


GUI_autism_peer_gmm3 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 3, data = GUI_autism_long_sdq_peer, mixture = ~ Sweep, 
nwg=T, B = GUI_autism_peer_gmm1)
summary(GUI_autism_peer_gmm3)

GUI_autism_peer_gmm4 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 4, data = GUI_autism_long_sdq_peer, mixture = ~ Sweep, 
nwg=T, B = GUI_autism_peer_gmm1)
summary(GUI_autism_peer_gmm4)

# make a table with results for the 4 models:
fit_ind_GUI_peer <- summarytable(GUI_autism_peer_gmm1, GUI_autism_peer_gmm2, GUI_autism_peer_gmm3, GUI_autism_peer_gmm4,which = c("AIC","BIC","SABIC","%class","entropy","npm","loglik"))
```

## Prosocial 
```{r}

GUI_autism_pro_gmm1 <- hlme(value ~ Sweep, subject = "numericID", random=~1, ng = 1, data =
GUI_autism_long_sdq_pro)
summary(GUI_autism_pro_gmm1)


GUI_autism_pro_gmm2 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 2, data = GUI_autism_long_sdq_pro, mixture = ~ Sweep,
nwg=T, B = GUI_autism_pro_gmm1)
summary(GUI_autism_pro_gmm2)


GUI_autism_pro_gmm3 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 3, data = GUI_autism_long_sdq_pro, mixture = ~ Sweep, 
nwg=T, B = GUI_autism_pro_gmm1)
summary(GUI_autism_pro_gmm3)

GUI_autism_pro_gmm4 <- hlme(value ~ Sweep, subject = "numericID", random=~1,
ng = 4, data = GUI_autism_long_sdq_pro, mixture = ~ Sweep, 
nwg=T, B = GUI_autism_pro_gmm1)
summary(GUI_autism_pro_gmm4)

# make a table with results for the 4 models:
fit_ind_GUI_pro <- summarytable(GUI_autism_pro_gmm1, GUI_autism_pro_gmm2, GUI_autism_pro_gmm3, GUI_autism_pro_gmm4,which = c("AIC","BIC","SABIC","%class","entropy","npm","loglik"))
```

## SDQ total graphs

```{r}

#GUI_autism_long_sdq_total$numericID <- as.character(GUI_autism_long_sdq_total$numericID)
GUI_autism_ttl_people2 <- as.data.frame(GUI_autism_ttl_gmm2$pprob[,1:2])

GUI_autism_long_sdq_total_gmm2 <- full_join(GUI_autism_long_sdq_total, GUI_autism_ttl_people2, by = "numericID")
GUI_autism_long_sdq_total_gmm2$numericID <- as.character(GUI_autism_long_sdq_total_gmm2$numericID)
GUI_autism_long_sdq_total_gmm2$class <- as.factor(GUI_autism_long_sdq_total_gmm2$class)
# GUI_autism_long_sdq_total$group_GUI_autism_ttl_gmm2_s <- factor(GUI_autism_ttl_people2$class[unlist(sapply(GUI_autism_long_sdq_total$numericID, function(x) which(GUI_autism_ttl_people2$numeircID==x)))])


p_GUI_autism_ttl_gmm2 <- ggplot(GUI_autism_long_sdq_total_gmm2, aes(as.character(Sweep), value, group = hicid, colour=class)) + geom_line() + geom_smooth(aes(group =class), method="loess", linewidth=2, se=F)  + scale_y_continuous(limits = c(0,40)) + scale_x_discrete(labels = ireland_age_break) +labs(x="Age(years)",y="Total SDQ Score",colour="Latent Class") 



p_GUI_autism_ttl_gmm2_s <- ggplot(GUI_autism_long_sdq_total_gmm2 , aes(as.character(Sweep), value, group = hicid, colour=class)) + geom_smooth(aes(group= numericID, colour=class),size=0.5, se=F) + geom_smooth(aes(group=class), method="loess", linewidth=2, se=T)  + scale_y_continuous(limits = c(0,40)) + scale_x_discrete(labels = age_k) +labs(x="Age(years)",y="Total SDQ Score",colour="Latent Class") 

suppressWarnings(print(p_GUI_autism_ttl_gmm2))
suppressWarnings(print(p_GUI_autism_ttl_gmm2_s))
```
